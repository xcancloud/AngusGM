# 用户管理模块 - 后端API接口文档

## 基础信息
- **模块名称**: 用户管理
- **模块路径**: `/api/v1/users`
- **负责功能**: 用户的增删改查、邀请、锁定/解锁、重置密码

---

## 接口列表

### 1. 获取用户统计数据
**接口地址**: `GET /api/v1/users/stats`

**响应数据**:
```json
{
  "code": "S",
  "message": "成功",
  "data": {
    "totalUsers": 234,
    "activeUsers": 198,
    "disabledUsers": 28,
    "pendingUsers": 8,
    "onlineUsers": 45,
    "newUsersThisMonth": 15
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

### 2. 获取用户列表（分页）
**接口地址**: `GET /api/v1/users`

**查询参数**:
- `page`: 页码，默认1
- `size`: 每页大小，默认10
- `keyword`: 搜索关键词（姓名、邮箱、手机号）
- `status`: 状态筛选（已激活、已禁用、待审核）
- `role`: 角色筛选
- `department`: 部门筛选
- `isLocked`: 锁定状态（true、false）
- `isOnline`: 在线状态（true、false）

**请求示例**:
```
GET /api/v1/users?page=1&size=10&keyword=张&status=已激活&department=技术部
```

**响应数据**:
```json
{
  "code": "S",
  "message": "成功",
  "data": {
    "total": "234",
    "list": [
      {
        "tenantId": "1",
        "createdBy": "1000001",
        "creator": "系统管理员",
        "createdDate": "2025-01-15 10:00:00",
        "modifiedBy": "1000001",
        "modifier": "系统管理员",
        "modifiedDate": "2025-12-03 14:30:00",
        "id": "U001",
        "username": "zhangsan",
        "name": "张三",
        "email": "zhangsan@example.com",
        "phone": "138****1234",
        "avatar": "https://images.unsplash.com/photo-1652795385761-7ac287d0cd03?w=100",
        "role": "管理员",
        "roleIds": ["2", "3"],
        "department": "技术部",
        "departmentId": "D001",
        "status": "已激活",
        "enableStatus": "已启用",
        "isLocked": false,
        "isOnline": true,
        "lastLogin": "2025-12-19 09:15:00",
        "accountType": "sub"
      }
    ]
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

### 3. 创建用户
**接口地址**: `POST /api/v1/users`

**请求参数**:
```json
{
  "username": "lisi",
  "name": "李四",
  "email": "lisi@example.com",
  "phone": "13900139000",
  "password": "Password123!",
  "departmentId": "D001",
  "roleIds": ["2", "3"],
  "avatar": "https://avatar.url/lisi.png",
  "status": "已激活"
}
```

**响应数据**:
```json
{
  "code": "S",
  "message": "创建成功",
  "data": {
    "tenantId": "1",
    "createdBy": "1000001",
    "creator": "系统管理员",
    "createdDate": "2025-12-19 10:30:00",
    "modifiedBy": "1000001",
    "modifier": "系统管理员",
    "modifiedDate": "2025-12-19 10:30:00",
    "id": "U100",
    "username": "lisi",
    "name": "李四",
    "email": "lisi@example.com",
    "phone": "13900139000",
    "avatar": "https://avatar.url/lisi.png",
    "role": "管理员",
    "roleIds": ["2", "3"],
    "department": "技术部",
    "departmentId": "D001",
    "status": "已激活",
    "enableStatus": "已启用",
    "isLocked": false,
    "isOnline": false,
    "lastLogin": null,
    "accountType": "sub"
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

### 4. 获取用户详情
**接口地址**: `GET /api/v1/users/{id}`

**路径参数**:
- `id`: 用户ID

**响应数据**:
```json
{
  "code": "S",
  "message": "成功",
  "data": {
    "tenantId": "1",
    "createdBy": "1000001",
    "creator": "系统管理员",
    "createdDate": "2025-01-15 10:00:00",
    "modifiedBy": "1000001",
    "modifier": "系统管理员",
    "modifiedDate": "2025-12-03 14:30:00",
    "id": "U001",
    "username": "zhangsan",
    "name": "张三",
    "email": "zhangsan@example.com",
    "phone": "138****1234",
    "avatar": "https://images.unsplash.com/photo-1652795385761-7ac287d0cd03?w=100",
    "role": "管理员",
    "roleIds": ["2", "3"],
    "roles": [
      {
        "id": "2",
        "name": "租户管理员",
        "code": "TENANT_ADMIN"
      },
      {
        "id": "3",
        "name": "部门管理员",
        "code": "DEPT_ADMIN"
      }
    ],
    "department": "技术部",
    "departmentId": "D001",
    "departmentPath": "公司/研发中心/技术部",
    "status": "已激活",
    "enableStatus": "已启用",
    "isLocked": false,
    "isOnline": true,
    "lastLogin": "2025-12-19 09:15:00",
    "accountType": "sub",
    "groups": [
      {
        "id": "G001",
        "name": "AngusGM项目组"
      }
    ],
    "loginHistory": [
      {
        "time": "2025-12-19 09:15:00",
        "ip": "192.168.1.100",
        "location": "北京"
      }
    ]
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

### 5. 更新用户信息
**接口地址**: `PUT /api/v1/users/{id}`

**路径参数**:
- `id`: 用户ID

**请求参数**:
```json
{
  "name": "张三三",
  "email": "zhangsan_new@example.com",
  "phone": "13800138001",
  "departmentId": "D002",
  "roleIds": ["2", "4"],
  "avatar": "https://avatar.url/new.png",
  "status": "已激活"
}
```

**响应数据**: 同创建用户（返回完整用户信息）

---

### 6. 删除用户
**接口地址**: `DELETE /api/v1/users/{id}`

**路径参数**:
- `id`: 用户ID

**响应**: HTTP 204 No Content（无响应体）

---

### 7. 批量删除用户
**接口地址**: `DELETE /api/v1/users/batch`

**请求参数**:
```json
{
  "userIds": ["U010", "U011", "U012"]
}
```

**响应**: HTTP 204 No Content（无响应体）

---

### 8. 启用/禁用用户
**接口地址**: `PATCH /api/v1/users/{id}/status`

**路径参数**:
- `id`: 用户ID

**请求参数**:
```json
{
  "enableStatus": "已禁用"
}
```

**响应数据**:
```json
{
  "code": "S",
  "message": "状态更新成功",
  "data": {
    "id": "U001",
    "enableStatus": "已禁用",
    "modifiedDate": "2025-12-19 11:00:00"
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

### 9. 锁定/解锁用户
**接口地址**: `PATCH /api/v1/users/{id}/lock`

**路径参数**:
- `id`: 用户ID

**请求参数**:
```json
{
  "isLocked": true,
  "reason": "多次登录失败"
}
```

**响应数据**:
```json
{
  "code": "S",
  "message": "用户已锁定",
  "data": {
    "id": "U001",
    "isLocked": true,
    "lockReason": "多次登录失败",
    "lockTime": "2025-12-19 11:00:00"
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

### 10. 重置用户密码
**接口地址**: `POST /api/v1/users/{id}/reset-password`

**路径参数**:
- `id`: 用户ID

**请求参数**:
```json
{
  "newPassword": "NewPassword123!",
  "sendEmail": true
}
```

**响应数据**:
```json
{
  "code": "S",
  "message": "密码重置成功",
  "data": {
    "id": "U001",
    "passwordResetTime": "2025-12-19 11:00:00",
    "emailSent": true
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

### 11. 邀请用户
**接口地址**: `POST /api/v1/users/invite`

**请求参数**:
```json
{
  "email": "newuser@example.com",
  "roleId": "2",
  "departmentId": "D001",
  "message": "欢迎加入我们的团队！",
  "expireDays": 7
}
```

**响应数据**:
```json
{
  "code": "S",
  "message": "邀请发送成功",
  "data": {
    "tenantId": "1",
    "createdBy": "1000001",
    "creator": "系统管理员",
    "createdDate": "2025-12-19 10:30:00",
    "modifiedBy": "1000001",
    "modifier": "系统管理员",
    "modifiedDate": "2025-12-19 10:30:00",
    "id": "INV001",
    "email": "newuser@example.com",
    "roleId": "2",
    "roleName": "租户管理员",
    "departmentId": "D001",
    "departmentName": "技术部",
    "invitedBy": "1000001",
    "inviterName": "系统管理员",
    "inviteDate": "2025-12-19 10:30:00",
    "expiryDate": "2025-12-26 10:30:00",
    "status": "待接受",
    "inviteCode": "INV-ABC123",
    "inviteUrl": "https://gm.xcan.cloud/invite/INV-ABC123"
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

### 12. 获取邀请列表
**接口地址**: `GET /api/v1/users/invites`

**查询参数**:
- `page`: 页码，默认1
- `size`: 每页大小，默认10
- `keyword`: 搜索关键词（邮箱）
- `status`: 状态筛选（待接受、已过期、已接受、已取消）

**响应数据**:
```json
{
  "code": "S",
  "message": "成功",
  "data": {
    "total": "15",
    "list": [
      {
        "tenantId": "1",
        "createdBy": "1000001",
        "creator": "系统管理员",
        "createdDate": "2025-12-19 10:30:00",
        "modifiedBy": "1000001",
        "modifier": "系统管理员",
        "modifiedDate": "2025-12-19 10:30:00",
        "id": "INV001",
        "email": "newuser@example.com",
        "roleId": "2",
        "roleName": "租户管理员",
        "departmentId": "D001",
        "departmentName": "技术部",
        "invitedBy": "1000001",
        "inviterName": "系统管理员",
        "inviteDate": "2025-12-19 10:30:00",
        "expiryDate": "2025-12-26 10:30:00",
        "status": "待接受",
        "inviteCode": "INV-ABC123"
      }
    ]
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

### 13. 取消邀请
**接口地址**: `DELETE /api/v1/users/invites/{id}`

**路径参数**:
- `id`: 邀请ID

**响应**: HTTP 204 No Content（无响应体）

---

### 14. 重新发送邀请
**接口地址**: `POST /api/v1/users/invites/{id}/resend`

**路径参数**:
- `id`: 邀请ID

**响应数据**:
```json
{
  "code": "S",
  "message": "邀请已重新发送",
  "data": {
    "id": "INV001",
    "resentTime": "2025-12-19 11:00:00"
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

### 15. 修改密码（用户自己）
**接口地址**: `POST /api/v1/users/change-password`

**请求参数**:
```json
{
  "oldPassword": "OldPassword123!",
  "newPassword": "NewPassword123!",
  "confirmPassword": "NewPassword123!"
}
```

**响应数据**:
```json
{
  "code": "S",
  "message": "密码修改成功",
  "data": null,
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

### 16. 获取当前登录用户信息
**接口地址**: `GET /api/v1/users/current`

**响应数据**: 同获取用户详情

---

### 17. 更新当前用户信息
**接口地址**: `PUT /api/v1/users/current`

**请求参数**:
```json
{
  "name": "新名称",
  "avatar": "https://avatar.url/new.png",
  "phone": "13800138001"
}
```

**响应数据**: 同创建用户（返回完整用户信息）

---

## 错误码说明

| 错误码 | 说明 |
|--------|------|
| USER_001 | 用户名已存在 |
| USER_002 | 邮箱已被使用 |
| USER_003 | 手机号已被使用 |
| USER_004 | 用户不存在 |
| USER_005 | 用户已被禁用 |
| USER_006 | 用户已被锁定 |
| USER_007 | 原密码错误 |
| USER_008 | 邀请已过期 |
| USER_009 | 邀请码无效 |
| USER_010 | 主账号不能删除 |
