# 服务管理模块 - 后端API接口文档

## 基础信息
- **模块名称**: 服务管理
- **模块路径**: `/api/v1/services`
- **负责功能**: 微服务实例管理、健康检查、服务注册中心配置

---

## 接口列表

### 1. 获取服务统计数据
**接口地址**: `GET /api/v1/services/stats`

**响应数据**:
```json
{
  "code": "S",
  "message": "成功",
  "data": {
    "totalServices": 12,
    "totalInstances": 28,
    "upInstances": 25,
    "downInstances": 3,
    "avgResponseTime": 245
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

### 2. 获取服务列表
**接口地址**: `GET /api/v1/services`

**查询参数**:
- `keyword`: 搜索关键词（服务名称）
- `status`: 状态筛选（UP、DOWN、OUT_OF_SERVICE）

**响应数据**:
```json
{
  "code": "S",
  "message": "成功",
  "data": [
    {
      "serviceName": "ANGUS-GM-SERVICE",
      "displayName": "AngusGM全局管理服务",
      "instances": [
        {
          "instanceId": "angus-gm-service-001",
          "hostName": "gm-server-01",
          "ipAddr": "192.168.1.101",
          "port": 8080,
          "securePort": 8443,
          "status": "UP",
          "healthCheckUrl": "http://192.168.1.101:8080/actuator/health",
          "statusPageUrl": "http://192.168.1.101:8080/actuator/info",
          "homePageUrl": "http://192.168.1.101:8080/",
          "lastHeartbeat": "2024-12-19 14:32:15",
          "uptime": "15天 6小时 23分钟",
          "metadata": {
            "version": "1.0.0",
            "zone": "beijing",
            "profile": "prod"
          }
        },
        {
          "instanceId": "angus-gm-service-002",
          "hostName": "gm-server-02",
          "ipAddr": "192.168.1.102",
          "port": 8080,
          "securePort": 8443,
          "status": "UP",
          "healthCheckUrl": "http://192.168.1.102:8080/actuator/health",
          "statusPageUrl": "http://192.168.1.102:8080/actuator/info",
          "homePageUrl": "http://192.168.1.102:8080/",
          "lastHeartbeat": "2024-12-19 14:32:18",
          "uptime": "10天 3小时 45分钟",
          "metadata": {
            "version": "1.0.0",
            "zone": "beijing",
            "profile": "prod"
          }
        }
      ]
    }
  ],
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

### 3. 获取服务详情
**接口地址**: `GET /api/v1/services/{serviceName}`

**路径参数**:
- `serviceName`: 服务名称

**响应数据**:
```json
{
  "code": "S",
  "message": "成功",
  "data": {
    "serviceName": "ANGUS-GM-SERVICE",
    "displayName": "AngusGM全局管理服务",
    "totalInstances": 2,
    "upInstances": 2,
    "downInstances": 0,
    "instances": [
      {
        "instanceId": "angus-gm-service-001",
        "hostName": "gm-server-01",
        "ipAddr": "192.168.1.101",
        "port": 8080,
        "securePort": 8443,
        "status": "UP",
        "healthCheckUrl": "http://192.168.1.101:8080/actuator/health",
        "statusPageUrl": "http://192.168.1.101:8080/actuator/info",
        "homePageUrl": "http://192.168.1.101:8080/",
        "lastHeartbeat": "2024-12-19 14:32:15",
        "uptime": "15天 6小时 23分钟",
        "metadata": {
          "version": "1.0.0",
          "zone": "beijing",
          "profile": "prod",
          "management.port": "8080"
        }
      }
    ]
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

### 4. 刷新服务列表
**接口地址**: `POST /api/v1/services/refresh`

**响应数据**:
```json
{
  "code": "S",
  "message": "刷新成功",
  "data": {
    "refreshTime": "2025-12-19 14:35:00",
    "totalServices": 12,
    "totalInstances": 28
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

### 5. 获取服务实例健康状态
**接口地址**: `GET /api/v1/services/{serviceName}/instances/{instanceId}/health`

**路径参数**:
- `serviceName`: 服务名称
- `instanceId`: 实例ID

**响应数据**:
```json
{
  "code": "S",
  "message": "成功",
  "data": {
    "status": "UP",
    "details": {
      "diskSpace": {
        "status": "UP",
        "total": 500107862016,
        "free": 423908069376,
        "threshold": 10485760
      },
      "db": {
        "status": "UP",
        "database": "MySQL",
        "validationQuery": "isValid()"
      },
      "redis": {
        "status": "UP",
        "version": "6.2.6"
      }
    }
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

### 6. 下线服务实例
**接口地址**: `PATCH /api/v1/services/{serviceName}/instances/{instanceId}/status`

**路径参数**:
- `serviceName`: 服务名称
- `instanceId`: 实例ID

**请求参数**:
```json
{
  "status": "OUT_OF_SERVICE"
}
```

**响应数据**:
```json
{
  "code": "S",
  "message": "实例状态更新成功",
  "data": {
    "instanceId": "angus-gm-service-001",
    "status": "OUT_OF_SERVICE",
    "modifiedDate": "2025-12-19 14:40:00"
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

### 7. 获取Eureka配置
**接口地址**: `GET /api/v1/services/eureka/config`

**响应数据**:
```json
{
  "code": "S",
  "message": "成功",
  "data": {
    "serviceUrl": "http://eureka-server:8761/eureka/",
    "enableAuth": true,
    "username": "admin",
    "password": "******",
    "syncInterval": 30,
    "enableSsl": false,
    "connectTimeout": 5000,
    "readTimeout": 8000
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

### 8. 更新Eureka配置
**接口地址**: `PUT /api/v1/services/eureka/config`

**请求参数**:
```json
{
  "serviceUrl": "http://eureka-server:8761/eureka/",
  "enableAuth": true,
  "username": "admin",
  "password": "newpassword",
  "syncInterval": 60,
  "enableSsl": false,
  "connectTimeout": 5000,
  "readTimeout": 8000
}
```

**响应数据**:
```json
{
  "code": "S",
  "message": "配置更新成功",
  "data": {
    "serviceUrl": "http://eureka-server:8761/eureka/",
    "enableAuth": true,
    "username": "admin",
    "password": "******",
    "syncInterval": 60,
    "enableSsl": false,
    "connectTimeout": 5000,
    "readTimeout": 8000,
    "modifiedDate": "2025-12-19 14:45:00"
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

### 9. 测试Eureka连接
**接口地址**: `POST /api/v1/services/eureka/test`

**请求参数**:
```json
{
  "serviceUrl": "http://eureka-server:8761/eureka/",
  "username": "admin",
  "password": "password"
}
```

**响应数据**:
```json
{
  "code": "S",
  "message": "连接测试成功",
  "data": {
    "connected": true,
    "responseTime": 125,
    "servicesCount": 12
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

### 10. 获取服务调用统计
**接口地址**: `GET /api/v1/services/{serviceName}/stats`

**路径参数**:
- `serviceName`: 服务名称

**查询参数**:
- `startDate`: 开始日期
- `endDate`: 结束日期

**响应数据**:
```json
{
  "code": "S",
  "message": "成功",
  "data": {
    "serviceName": "ANGUS-GM-SERVICE",
    "period": {
      "startDate": "2025-12-12",
      "endDate": "2025-12-19"
    },
    "totalRequests": 1250000,
    "successRequests": 1248500,
    "failedRequests": 1500,
    "avgResponseTime": 245,
    "maxResponseTime": 3500,
    "minResponseTime": 10,
    "requestsPerDay": [
      {
        "date": "2025-12-12",
        "count": 180000
      },
      {
        "date": "2025-12-13",
        "count": 175000
      }
    ]
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

## 错误码说明

| 错误码 | 说明 |
|--------|------|
| SERVICE_001 | 服务不存在 |
| SERVICE_002 | 服务实例不存在 |
| SERVICE_003 | Eureka连接失败 |
| SERVICE_004 | Eureka认证失败 |
| SERVICE_005 | 服务实例已下线 |
