# 认证授权模块 - 后端API接口文档

## 基础信息
- **模块名称**: 认证授权
- **模块路径**: `/api/v1/auth`
- **负责功能**: 用户登录、注册、密码找回、第三方登录

---

## 接口列表

### 1. 账号密码登录
**接口地址**: `POST /api/v1/auth/login`

**请求参数**:
```json
{
  "loginType": "account",
  "username": "admin@angusgm.com",
  "password": "Password123!",
  "captcha": "1234",
  "captchaKey": "captcha-uuid-xxx"
}
```

**响应数据**:
```json
{
  "code": "S",
  "message": "登录成功",
  "data": {
    "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "refreshToken": "refresh-token-xxx",
    "tokenType": "Bearer",
    "expiresIn": 7200,
    "user": {
      "tenantId": "1",
      "createdBy": "1000001",
      "creator": "系统管理员",
      "createdDate": "2024-01-01 00:00:00",
      "modifiedBy": "1000001",
      "modifier": "系统管理员",
      "modifiedDate": "2025-12-03 10:30:00",
      "id": "1000001",
      "username": "admin",
      "name": "系统管理员",
      "email": "admin@angusgm.com",
      "phone": "138****1234",
      "avatar": "https://images.unsplash.com/photo-1652795385761-7ac287d0cd03?w=100",
      "accountType": "main",
      "roles": [
        {
          "id": "1",
          "name": "系统管理员",
          "code": "SYSTEM_ADMIN"
        }
      ],
      "permissions": [
        "user:read",
        "user:write",
        "tenant:read",
        "tenant:write"
      ]
    }
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

### 2. 短信验证码登录
**接口地址**: `POST /api/v1/auth/login`

**请求参数**:
```json
{
  "loginType": "sms",
  "phone": "13800138000",
  "code": "123456"
}
```

**响应数据**: 同账号密码登录

---

### 3. 邮箱验证码登录
**接口地址**: `POST /api/v1/auth/login`

**请求参数**:
```json
{
  "loginType": "email",
  "email": "user@example.com",
  "code": "123456"
}
```

**响应数据**: 同账号密码登录

---

### 4. 第三方登录（微信/Github/Google）
**接口地址**: `POST /api/v1/auth/oauth/login`

**请求参数**:
```json
{
  "provider": "wechat",
  "code": "oauth-code-xxx",
  "state": "random-state-xxx"
}
```

**支持的provider值**:
- `wechat`: 微信登录
- `github`: Github登录
- `google`: Google登录

**响应数据**: 同账号密码登录

---

### 5. 发送短信验证码
**接口地址**: `POST /api/v1/auth/sms/send`

**请求参数**:
```json
{
  "phone": "13800138000",
  "scene": "login"
}
```

**scene参数说明**:
- `login`: 登录场景
- `register`: 注册场景
- `reset_password`: 重置密码场景

**响应数据**:
```json
{
  "code": "S",
  "message": "验证码发送成功",
  "data": {
    "codeKey": "sms-code-uuid-xxx",
    "expireTime": 300
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

### 6. 发送邮箱验证码
**接口地址**: `POST /api/v1/auth/email/send`

**请求参数**:
```json
{
  "email": "user@example.com",
  "scene": "login"
}
```

**响应数据**: 同发送短信验证码

---

### 7. 短信注册
**接口地址**: `POST /api/v1/auth/register`

**请求参数**:
```json
{
  "registerType": "sms",
  "phone": "13800138000",
  "code": "123456",
  "password": "Password123!",
  "confirmPassword": "Password123!",
  "inviteCode": "INV123456",
  "agreement": true
}
```

**响应数据**:
```json
{
  "code": "S",
  "message": "注册成功",
  "data": {
    "tenantId": "1",
    "createdBy": "1000002",
    "creator": "新用户",
    "createdDate": "2025-12-19 10:30:00",
    "modifiedBy": "1000002",
    "modifier": "新用户",
    "modifiedDate": "2025-12-19 10:30:00",
    "id": "1000002",
    "username": "user_13800138000",
    "name": "新用户",
    "phone": "13800138000",
    "status": "待审核",
    "accountType": "sub"
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

### 8. 邮箱注册
**接口地址**: `POST /api/v1/auth/register`

**请求参数**:
```json
{
  "registerType": "email",
  "email": "newuser@example.com",
  "code": "123456",
  "password": "Password123!",
  "confirmPassword": "Password123!",
  "inviteCode": "INV123456",
  "agreement": true
}
```

**响应数据**: 同短信注册

---

### 9. 找回密码 - 发送验证码
**接口地址**: `POST /api/v1/auth/password/send-code`

**请求参数**:
```json
{
  "type": "sms",
  "account": "13800138000"
}
```

**type参数**:
- `sms`: 短信验证
- `email`: 邮箱验证

**响应数据**:
```json
{
  "code": "S",
  "message": "验证码发送成功",
  "data": {
    "codeKey": "reset-pwd-uuid-xxx",
    "expireTime": 300
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

### 10. 找回密码 - 重置密码
**接口地址**: `POST /api/v1/auth/password/reset`

**请求参数**:
```json
{
  "type": "sms",
  "account": "13800138000",
  "code": "123456",
  "newPassword": "NewPassword123!",
  "confirmPassword": "NewPassword123!"
}
```

**响应数据**:
```json
{
  "code": "S",
  "message": "密码重置成功",
  "data": null,
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

### 11. 刷新Token
**接口地址**: `POST /api/v1/auth/refresh`

**请求参数**:
```json
{
  "refreshToken": "refresh-token-xxx"
}
```

**响应数据**:
```json
{
  "code": "S",
  "message": "Token刷新成功",
  "data": {
    "accessToken": "new-access-token-xxx",
    "refreshToken": "new-refresh-token-xxx",
    "tokenType": "Bearer",
    "expiresIn": 7200
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

### 12. 退出登录
**接口地址**: `POST /api/v1/auth/logout`

**请求头**:
```
Authorization: Bearer {access_token}
```

**响应数据**:
```json
{
  "code": "S",
  "message": "退出登录成功",
  "data": null,
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

### 13. 获取验证码图片
**接口地址**: `GET /api/v1/auth/captcha`

**响应数据**:
```json
{
  "code": "S",
  "message": "成功",
  "data": {
    "captchaKey": "captcha-uuid-xxx",
    "captchaImage": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUg...",
    "expireTime": 300
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

### 14. 验证邀请码
**接口地址**: `POST /api/v1/auth/invite-code/verify`

**请求参数**:
```json
{
  "inviteCode": "INV123456"
}
```

**响应数据**:
```json
{
  "code": "S",
  "message": "邀请码有效",
  "data": {
    "valid": true,
    "tenantName": "科技创新公司",
    "inviterName": "张三",
    "expireDate": "2025-12-31"
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

## 错误码说明

| 错误码 | 说明 |
|--------|------|
| AUTH_001 | 用户名或密码错误 |
| AUTH_002 | 验证码错误 |
| AUTH_003 | 验证码已过期 |
| AUTH_004 | 账号已被禁用 |
| AUTH_005 | Token已过期 |
| AUTH_006 | Token无效 |
| AUTH_007 | 邀请码无效或已过期 |
| AUTH_008 | 手机号已被注册 |
| AUTH_009 | 邮箱已被注册 |
| AUTH_010 | 密码强度不符合要求 |
