# 部门管理模块 - 后端API接口文档

## 基础信息
- **模块名称**: 部门管理
- **模块路径**: `/api/v1/departments`
- **负责功能**: 部门的增删改查、树形结构管理、成员管理

---

## 接口列表

### 1. 获取部门统计数据
**接口地址**: `GET /api/v1/departments/stats`

**响应数据**:
```json
{
  "code": "S",
  "message": "成功",
  "data": {
    "totalDepartments": 156,
    "enabledDepartments": 142,
    "disabledDepartments": 14,
    "totalUsers": 1234,
    "maxLevel": 6,
    "newDepartmentsThisMonth": 8
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

### 2. 获取部门树形结构
**接口地址**: `GET /api/v1/departments/tree`

**查询参数**:
- `status`: 状态筛选（已启用、已禁用）
- `includeUsers`: 是否包含用户信息，默认false

**响应数据**:
```json
{
  "code": "S",
  "message": "成功",
  "data": [
    {
      "tenantId": "1",
      "createdBy": "1000001",
      "creator": "系统管理员",
      "createdDate": "2024-01-15 10:00:00",
      "modifiedBy": "1000001",
      "modifier": "系统管理员",
      "modifiedDate": "2025-12-03 14:30:00",
      "id": "D001",
      "name": "技术部",
      "code": "TECH",
      "parentId": null,
      "managerName": "张三",
      "managerId": "U001",
      "userCount": 245,
      "level": 1,
      "status": "已启用",
      "path": "技术部",
      "children": [
        {
          "tenantId": "1",
          "createdBy": "1000001",
          "creator": "系统管理员",
          "createdDate": "2024-01-20 10:00:00",
          "modifiedBy": "1000001",
          "modifier": "系统管理员",
          "modifiedDate": "2025-12-03 14:30:00",
          "id": "D001-1",
          "name": "前端开发组",
          "code": "TECH-FE",
          "parentId": "D001",
          "managerName": "李四",
          "managerId": "U002",
          "userCount": 45,
          "level": 2,
          "status": "已启用",
          "path": "技术部/前端开发组",
          "children": []
        }
      ]
    }
  ],
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

### 3. 获取部门列表（分页）
**接口地址**: `GET /api/v1/departments`

**查询参数**:
- `page`: 页码，默认1
- `size`: 每页大小，默认10
- `keyword`: 搜索关键词（名称、编码）
- `status`: 状态筛选（已启用、已禁用）
- `parentId`: 父部门ID
- `level`: 层级筛选

**响应数据**:
```json
{
  "code": "S",
  "message": "成功",
  "data": {
    "total": "156",
    "list": [
      {
        "tenantId": "1",
        "createdBy": "1000001",
        "creator": "系统管理员",
        "createdDate": "2024-01-15 10:00:00",
        "modifiedBy": "1000001",
        "modifier": "系统管理员",
        "modifiedDate": "2025-12-03 14:30:00",
        "id": "D001",
        "name": "技术部",
        "code": "TECH",
        "parentId": null,
        "parentName": null,
        "managerName": "张三",
        "managerId": "U001",
        "managerAvatar": "https://avatar.url/zhangsan.png",
        "userCount": 245,
        "level": 1,
        "status": "已启用",
        "path": "技术部",
        "description": "技术研发部门"
      }
    ]
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

### 4. 创建部门
**接口地址**: `POST /api/v1/departments`

**请求参数**:
```json
{
  "name": "新部门",
  "code": "NEW-DEPT",
  "parentId": "D001",
  "managerId": "U005",
  "status": "已启用",
  "description": "部门描述信息"
}
```

**响应数据**:
```json
{
  "code": "S",
  "message": "创建成功",
  "data": {
    "tenantId": "1",
    "createdBy": "1000001",
    "creator": "系统管理员",
    "createdDate": "2025-12-19 10:30:00",
    "modifiedBy": "1000001",
    "modifier": "系统管理员",
    "modifiedDate": "2025-12-19 10:30:00",
    "id": "D100",
    "name": "新部门",
    "code": "NEW-DEPT",
    "parentId": "D001",
    "parentName": "技术部",
    "managerName": "王五",
    "managerId": "U005",
    "managerAvatar": "https://avatar.url/wangwu.png",
    "userCount": 0,
    "level": 2,
    "status": "已启用",
    "path": "技术部/新部门",
    "description": "部门描述信息"
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

### 5. 获取部门详情
**接口地址**: `GET /api/v1/departments/{id}`

**路径参数**:
- `id`: 部门ID

**响应数据**:
```json
{
  "code": "S",
  "message": "成功",
  "data": {
    "tenantId": "1",
    "createdBy": "1000001",
    "creator": "系统管理员",
    "createdDate": "2024-01-15 10:00:00",
    "modifiedBy": "1000001",
    "modifier": "系统管理员",
    "modifiedDate": "2025-12-03 14:30:00",
    "id": "D001",
    "name": "技术部",
    "code": "TECH",
    "parentId": null,
    "parentName": null,
    "managerName": "张三",
    "managerId": "U001",
    "managerAvatar": "https://avatar.url/zhangsan.png",
    "userCount": 245,
    "level": 1,
    "status": "已启用",
    "path": "技术部",
    "description": "技术研发部门",
    "members": [
      {
        "id": "U001",
        "name": "张三",
        "email": "zhangsan@example.com",
        "avatar": "https://avatar.url/zhangsan.png",
        "role": "管理员",
        "isManager": true
      }
    ],
    "subDepartments": [
      {
        "id": "D001-1",
        "name": "前端开发组",
        "userCount": 45
      }
    ]
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

### 6. 更新部门信息
**接口地址**: `PUT /api/v1/departments/{id}`

**路径参数**:
- `id`: 部门ID

**请求参数**:
```json
{
  "name": "技术研发部",
  "code": "TECH-RD",
  "parentId": null,
  "managerId": "U002",
  "status": "已启用",
  "description": "更新后的描述"
}
```

**响应数据**: 同创建部门（返回完整部门信息）

---

### 7. 删除部门
**接口地址**: `DELETE /api/v1/departments/{id}`

**路径参数**:
- `id`: 部门ID

**响应**: HTTP 204 No Content（无响应体）

---

### 8. 获取部门成员列表
**接口地址**: `GET /api/v1/departments/{id}/members`

**路径参数**:
- `id`: 部门ID

**查询参数**:
- `page`: 页码，默认1
- `size`: 每页大小，默认10
- `keyword`: 搜索关键词

**响应数据**:
```json
{
  "code": "S",
  "message": "成功",
  "data": {
    "total": "45",
    "list": [
      {
        "tenantId": "1",
        "createdBy": "1000001",
        "creator": "系统管理员",
        "createdDate": "2025-01-15 10:00:00",
        "modifiedBy": "1000001",
        "modifier": "系统管理员",
        "modifiedDate": "2025-12-03 14:30:00",
        "id": "U001",
        "name": "张三",
        "email": "zhangsan@example.com",
        "phone": "138****1234",
        "avatar": "https://avatar.url/zhangsan.png",
        "role": "管理员",
        "status": "已激活",
        "isManager": true,
        "joinDate": "2025-01-15"
      }
    ]
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

### 9. 添加部门成员
**接口地址**: `POST /api/v1/departments/{id}/members`

**路径参数**:
- `id`: 部门ID

**请求参数**:
```json
{
  "userIds": ["U010", "U011", "U012"]
}
```

**响应数据**:
```json
{
  "code": "S",
  "message": "添加成功",
  "data": {
    "departmentId": "D001",
    "addedCount": 3,
    "addedUsers": [
      {
        "id": "U010",
        "name": "用户1"
      },
      {
        "id": "U011",
        "name": "用户2"
      },
      {
        "id": "U012",
        "name": "用户3"
      }
    ]
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

### 10. 移除部门成员
**接口地址**: `DELETE /api/v1/departments/{id}/members/{userId}`

**路径参数**:
- `id`: 部门ID
- `userId`: 用户ID

**响应**: HTTP 204 No Content（无响应体）

---

### 11. 批量移除部门成员
**接口地址**: `DELETE /api/v1/departments/{id}/members`

**路径参数**:
- `id`: 部门ID

**请求参数**:
```json
{
  "userIds": ["U010", "U011", "U012"]
}
```

**响应**: HTTP 204 No Content（无响应体）

---

### 12. 转移部门成员
**接口地址**: `POST /api/v1/departments/{id}/members/transfer`

**路径参数**:
- `id`: 源部门ID

**请求参数**:
```json
{
  "targetDepartmentId": "D002",
  "userIds": ["U010", "U011"]
}
```

**响应数据**:
```json
{
  "code": "S",
  "message": "转移成功",
  "data": {
    "sourceDepartmentId": "D001",
    "targetDepartmentId": "D002",
    "transferredCount": 2
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

### 13. 设置部门负责人
**接口地址**: `PATCH /api/v1/departments/{id}/manager`

**路径参数**:
- `id`: 部门ID

**请求参数**:
```json
{
  "managerId": "U005"
}
```

**响应数据**:
```json
{
  "code": "S",
  "message": "负责人设置成功",
  "data": {
    "departmentId": "D001",
    "managerId": "U005",
    "managerName": "王五",
    "modifiedDate": "2025-12-19 11:00:00"
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

### 14. 获取部门路径
**接口地址**: `GET /api/v1/departments/{id}/path`

**路径参数**:
- `id`: 部门ID

**响应数据**:
```json
{
  "code": "S",
  "message": "成功",
  "data": {
    "path": "技术部/前端开发组/React团队",
    "pathArray": [
      {
        "id": "D001",
        "name": "技术部"
      },
      {
        "id": "D001-1",
        "name": "前端开发组"
      },
      {
        "id": "D001-1-1",
        "name": "React团队"
      }
    ]
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

### 15. 获取子部门列表
**接口地址**: `GET /api/v1/departments/{id}/children`

**路径参数**:
- `id`: 部门ID

**查询参数**:
- `recursive`: 是否递归获取所有子部门，默认false

**响应数据**:
```json
{
  "code": "S",
  "message": "成功",
  "data": [
    {
      "tenantId": "1",
      "createdBy": "1000001",
      "creator": "系统管理员",
      "createdDate": "2024-01-20 10:00:00",
      "modifiedBy": "1000001",
      "modifier": "系统管理员",
      "modifiedDate": "2025-12-03 14:30:00",
      "id": "D001-1",
      "name": "前端开发组",
      "code": "TECH-FE",
      "parentId": "D001",
      "managerName": "李四",
      "managerId": "U002",
      "userCount": 45,
      "level": 2,
      "status": "已启用"
    }
  ],
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

## 错误码说明

| 错误码 | 说明 |
|--------|------|
| DEPT_001 | 部门编码已存在 |
| DEPT_002 | 部门不存在 |
| DEPT_003 | 部门下存在子部门，无法删除 |
| DEPT_004 | 部门下存在用户，无法删除 |
| DEPT_005 | 不能将部门移动到自己的子部门下 |
| DEPT_006 | 父部门不存在 |
| DEPT_007 | 部门层级超过最大限制 |
| DEPT_008 | 部门负责人不存在 |
