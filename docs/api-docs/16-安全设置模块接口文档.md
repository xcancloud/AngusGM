# 安全设置模块 - 后端API接口文档

## 基础信息
- **模块名称**: 安全设置
- **模块路径**: `/api/v1/security`
- **负责功能**: 密码策略、登录限制、IP白名单、安全审计

---

## 接口列表

### 1. 获取安全设置概览
**接口地址**: `GET /api/v1/security/overview`

**响应数据**:
```json
{
  "code": "S",
  "message": "成功",
  "data": {
    "passwordPolicyEnabled": true,
    "twoFactorAuthEnabled": true,
    "ipWhitelistEnabled": false,
    "loginAttemptLimit": 5,
    "sessionTimeout": 7200,
    "lastSecurityAudit": "2025-12-15 10:00:00",
    "securityLevel": "高"
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

## 密码策略

### 2. 获取密码策略配置
**接口地址**: `GET /api/v1/security/password-policy`

**响应数据**:
```json
{
  "code": "S",
  "message": "成功",
  "data": {
    "tenantId": "1",
    "createdBy": "1000001",
    "creator": "系统管理员",
    "createdDate": "2024-01-15 10:00:00",
    "modifiedBy": "1000001",
    "modifier": "系统管理员",
    "modifiedDate": "2025-12-03 14:30:00",
    "id": "PWD_POLICY_001",
    "minLength": 8,
    "maxLength": 32,
    "requireUppercase": true,
    "requireLowercase": true,
    "requireNumbers": true,
    "requireSpecialChars": true,
    "preventReuse": 5,
    "expirationDays": 90,
    "warningDays": 7,
    "maxLoginAttempts": 5,
    "lockoutDuration": 30,
    "isEnabled": true
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

### 3. 更新密码策略配置
**接口地址**: `PUT /api/v1/security/password-policy`

**请求参数**:
```json
{
  "minLength": 10,
  "maxLength": 32,
  "requireUppercase": true,
  "requireLowercase": true,
  "requireNumbers": true,
  "requireSpecialChars": true,
  "preventReuse": 6,
  "expirationDays": 60,
  "warningDays": 7,
  "maxLoginAttempts": 3,
  "lockoutDuration": 60
}
```

**响应数据**: 同密码策略配置

---

## 双因素认证

### 4. 获取双因素认证配置
**接口地址**: `GET /api/v1/security/two-factor`

**响应数据**:
```json
{
  "code": "S",
  "message": "成功",
  "data": {
    "tenantId": "1",
    "createdBy": "1000001",
    "creator": "系统管理员",
    "createdDate": "2024-01-15 10:00:00",
    "modifiedBy": "1000001",
    "modifier": "系统管理员",
    "modifiedDate": "2025-12-03 14:30:00",
    "id": "2FA_CONFIG_001",
    "isEnabled": true,
    "methods": ["sms", "email", "totp"],
    "defaultMethod": "sms",
    "codeExpiration": 300,
    "codeLength": 6,
    "trustDeviceDays": 30,
    "enforceForAdmins": true,
    "enforceForAllUsers": false
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

### 5. 更新双因素认证配置
**接口地址**: `PUT /api/v1/security/two-factor`

**请求参数**:
```json
{
  "isEnabled": true,
  "methods": ["sms", "email", "totp"],
  "defaultMethod": "totp",
  "codeExpiration": 600,
  "trustDeviceDays": 30,
  "enforceForAdmins": true,
  "enforceForAllUsers": true
}
```

**响应数据**: 同双因素认证配置

---

## IP白名单管理

### 6. 获取IP白名单列表（分页）
**接口地址**: `GET /api/v1/security/ip-whitelist`

**查询参数**:
- `page`: 页码，默认1
- `size`: 每页大小，默认10
- `keyword`: 搜索关键词（IP地址、描述）
- `status`: 状态筛选（启用、禁用）

**响应数据**:
```json
{
  "code": "S",
  "message": "成功",
  "data": {
    "total": "25",
    "list": [
      {
        "tenantId": "1",
        "createdBy": "1000001",
        "creator": "系统管理员",
        "createdDate": "2024-11-15 10:00:00",
        "modifiedBy": "1000001",
        "modifier": "系统管理员",
        "modifiedDate": "2025-12-03 14:30:00",
        "id": "IP_WHITE_001",
        "ipAddress": "192.168.1.100",
        "ipRange": "192.168.1.100-192.168.1.200",
        "description": "办公室网段",
        "status": "启用",
        "lastUsed": "2025-12-19 10:30:00",
        "usageCount": 1250
      }
    ]
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

### 7. 添加IP白名单
**接口地址**: `POST /api/v1/security/ip-whitelist`

**请求参数**:
```json
{
  "ipAddress": "192.168.2.50",
  "ipRange": "192.168.2.1-192.168.2.100",
  "description": "研发部网段",
  "status": "启用"
}
```

**响应数据**: 同IP白名单列表中的单项数据

---

### 8. 更新IP白名单
**接口地址**: `PUT /api/v1/security/ip-whitelist/{id}`

**路径参数**:
- `id`: 白名单ID

**请求参数**: 同添加IP白名单

**响应数据**: 同IP白名单列表中的单项数据

---

### 9. 删除IP白名单
**接口地址**: `DELETE /api/v1/security/ip-whitelist/{id}`

**路径参数**:
- `id`: 白名单ID

**响应**: HTTP 204 No Content（无响应体）

---

## 会话管理

### 10. 获取会话配置
**接口地址**: `GET /api/v1/security/session`

**响应数据**:
```json
{
  "code": "S",
  "message": "成功",
  "data": {
    "tenantId": "1",
    "createdBy": "1000001",
    "creator": "系统管理员",
    "createdDate": "2024-01-15 10:00:00",
    "modifiedBy": "1000001",
    "modifier": "系统管理员",
    "modifiedDate": "2025-12-03 14:30:00",
    "id": "SESSION_CONFIG_001",
    "timeout": 7200,
    "maxConcurrent": 3,
    "allowMultipleDevices": true,
    "autoLogoutEnabled": true,
    "rememberMeDays": 30
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

### 11. 更新会话配置
**接口地址**: `PUT /api/v1/security/session`

**请求参数**:
```json
{
  "timeout": 3600,
  "maxConcurrent": 1,
  "allowMultipleDevices": false,
  "autoLogoutEnabled": true,
  "rememberMeDays": 7
}
```

**响应数据**: 同会话配置

---

### 12. 获取活跃会话列表
**接口地址**: `GET /api/v1/security/sessions/active`

**查询参数**:
- `page`: 页码，默认1
- `size`: 每页大小，默认10
- `userId`: 用户ID筛选

**响应数据**:
```json
{
  "code": "S",
  "message": "成功",
  "data": {
    "total": "156",
    "list": [
      {
        "id": "SESSION_001",
        "userId": "U001",
        "userName": "张三",
        "ipAddress": "192.168.1.100",
        "location": "北京",
        "device": "Chrome 120 on Windows 10",
        "loginTime": "2025-12-19 09:00:00",
        "lastActivity": "2025-12-19 10:30:00",
        "expiresAt": "2025-12-19 11:00:00",
        "isCurrent": true
      }
    ]
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

### 13. 强制注销会话
**接口地址**: `DELETE /api/v1/security/sessions/{sessionId}`

**路径参数**:
- `sessionId`: 会话ID

**响应**: HTTP 204 No Content（无响应体）

---

## 安全审计

### 14. 获取安全事件列表（分页）
**接口地址**: `GET /api/v1/security/events`

**查询参数**:
- `page`: 页码，默认1
- `size`: 每页大小，默认10
- `type`: 事件类型（登录失败、密码修改、权限变更）
- `level`: 风险等级（低、中、高）
- `userId`: 用户ID筛选
- `startDate`: 开始日期
- `endDate`: 结束日期

**响应数据**:
```json
{
  "code": "S",
  "message": "成功",
  "data": {
    "total": "1250",
    "list": [
      {
        "tenantId": "1",
        "createdBy": "SYSTEM",
        "creator": "系统",
        "createdDate": "2025-12-19 10:30:00",
        "modifiedBy": "SYSTEM",
        "modifier": "系统",
        "modifiedDate": "2025-12-19 10:30:00",
        "id": "SEC_EVENT_001",
        "type": "登录失败",
        "level": "中",
        "userId": "U010",
        "userName": "李四",
        "ipAddress": "192.168.1.150",
        "location": "上海",
        "description": "连续3次输入错误密码",
        "eventTime": "2025-12-19 10:30:00",
        "handled": false
      }
    ]
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

### 15. 标记安全事件为已处理
**接口地址**: `PATCH /api/v1/security/events/{id}/handle`

**路径参数**:
- `id`: 事件ID

**请求参数**:
```json
{
  "handledNote": "已确认为正常行为，用户忘记密码"
}
```

**响应数据**:
```json
{
  "code": "S",
  "message": "标记成功",
  "data": {
    "id": "SEC_EVENT_001",
    "handled": true,
    "handledBy": "1000001",
    "handledTime": "2025-12-19 11:00:00",
    "handledNote": "已确认为正常行为，用户忘记密码"
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

### 16. 获取安全审计统计
**接口地址**: `GET /api/v1/security/audit-stats`

**查询参数**:
- `startDate`: 开始日期
- `endDate`: 结束日期

**响应数据**:
```json
{
  "code": "S",
  "message": "成功",
  "data": {
    "period": {
      "startDate": "2025-12-12",
      "endDate": "2025-12-19"
    },
    "totalEvents": 1250,
    "highRiskEvents": 25,
    "mediumRiskEvents": 180,
    "lowRiskEvents": 1045,
    "loginFailures": 156,
    "passwordChanges": 45,
    "permissionChanges": 23,
    "eventsByDay": [
      {
        "date": "2025-12-12",
        "count": 180
      },
      {
        "date": "2025-12-13",
        "count": 175
      }
    ]
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

## 错误码说明

| 错误码 | 说明 |
|--------|------|
| SEC_001 | 密码不符合安全策略 |
| SEC_002 | IP地址不在白名单中 |
| SEC_003 | 登录尝试次数超限 |
| SEC_004 | 会话已过期 |
| SEC_005 | 双因素认证失败 |
| SEC_006 | IP地址格式错误 |
| SEC_007 | 会话不存在 |
