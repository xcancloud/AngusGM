# 系统监控模块 - 后端API接口文档

## 基础信息
- **模块名称**: 系统监控
- **模块路径**: `/api/v1/monitoring`
- **负责功能**: 系统资源监控、性能指标、告警管理

---

## 接口列表

### 1. 获取系统监控概览
**接口地址**: `GET /api/v1/monitoring/overview`

**响应数据**:
```json
{
  "code": "S",
  "message": "成功",
  "data": {
    "systemStatus": "正常",
    "cpuUsage": 45.6,
    "memoryUsage": 62.3,
    "diskUsage": 58.9,
    "networkIn": "125 MB/s",
    "networkOut": "98 MB/s",
    "activeConnections": 1250,
    "uptime": "15天 6小时 23分钟",
    "lastUpdateTime": "2025-12-19 10:30:00"
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

## CPU监控

### 2. 获取CPU使用率数据
**接口地址**: `GET /api/v1/monitoring/cpu`

**查询参数**:
- `period`: 时间周期（1h、6h、24h、7d、30d）

**响应数据**:
```json
{
  "code": "S",
  "message": "成功",
  "data": {
    "current": 45.6,
    "average": 42.3,
    "max": 78.5,
    "min": 12.3,
    "cores": 8,
    "history": [
      {
        "time": "2025-12-19 10:00:00",
        "usage": 43.2
      },
      {
        "time": "2025-12-19 10:05:00",
        "usage": 45.6
      }
    ]
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

## 内存监控

### 3. 获取内存使用数据
**接口地址**: `GET /api/v1/monitoring/memory`

**查询参数**:
- `period`: 时间周期（1h、6h、24h、7d、30d）

**响应数据**:
```json
{
  "code": "S",
  "message": "成功",
  "data": {
    "total": "32 GB",
    "used": "20 GB",
    "free": "12 GB",
    "usagePercent": 62.5,
    "swapTotal": "8 GB",
    "swapUsed": "1.2 GB",
    "swapFree": "6.8 GB",
    "history": [
      {
        "time": "2025-12-19 10:00:00",
        "used": "19.5 GB",
        "usagePercent": 60.9
      },
      {
        "time": "2025-12-19 10:05:00",
        "used": "20 GB",
        "usagePercent": 62.5
      }
    ]
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

## 磁盘监控

### 4. 获取磁盘使用数据
**接口地址**: `GET /api/v1/monitoring/disk`

**响应数据**:
```json
{
  "code": "S",
  "message": "成功",
  "data": {
    "disks": [
      {
        "device": "/dev/sda1",
        "mountPoint": "/",
        "fileSystem": "ext4",
        "total": "500 GB",
        "used": "295 GB",
        "free": "205 GB",
        "usagePercent": 58.9
      },
      {
        "device": "/dev/sdb1",
        "mountPoint": "/data",
        "fileSystem": "ext4",
        "total": "2 TB",
        "used": "856 GB",
        "free": "1.16 TB",
        "usagePercent": 41.8
      }
    ]
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

## 网络监控

### 5. 获取网络流量数据
**接口地址**: `GET /api/v1/monitoring/network`

**查询参数**:
- `period`: 时间周期（1h、6h、24h、7d、30d）

**响应数据**:
```json
{
  "code": "S",
  "message": "成功",
  "data": {
    "interfaces": [
      {
        "name": "eth0",
        "ipAddress": "192.168.1.100",
        "status": "UP",
        "bytesIn": "1.25 TB",
        "bytesOut": "980 GB",
        "currentInRate": "125 MB/s",
        "currentOutRate": "98 MB/s"
      }
    ],
    "history": [
      {
        "time": "2025-12-19 10:00:00",
        "inRate": "120 MB/s",
        "outRate": "95 MB/s"
      },
      {
        "time": "2025-12-19 10:05:00",
        "inRate": "125 MB/s",
        "outRate": "98 MB/s"
      }
    ]
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

## 进程监控

### 6. 获取进程列表
**接口地址**: `GET /api/v1/monitoring/processes`

**查询参数**:
- `page`: 页码，默认1
- `size`: 每页大小，默认20
- `sortBy`: 排序字段（cpu、memory、name）
- `order`: 排序方向（asc、desc）

**响应数据**:
```json
{
  "code": "S",
  "message": "成功",
  "data": {
    "total": "156",
    "list": [
      {
        "pid": 1234,
        "name": "java",
        "user": "angus",
        "cpuPercent": 25.6,
        "memoryPercent": 18.5,
        "memoryUsage": "5.92 GB",
        "status": "running",
        "startTime": "2025-12-04 10:00:00",
        "command": "java -jar angusgm-service.jar"
      }
    ]
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

## 数据库监控

### 7. 获取数据库连接池状态
**接口地址**: `GET /api/v1/monitoring/database/pools`

**响应数据**:
```json
{
  "code": "S",
  "message": "成功",
  "data": [
    {
      "name": "primary-pool",
      "database": "angusgm",
      "active": 25,
      "idle": 15,
      "total": 50,
      "maxPool": 100,
      "waiting": 2,
      "status": "正常"
    }
  ],
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

### 8. 获取数据库性能指标
**接口地址**: `GET /api/v1/monitoring/database/performance`

**查询参数**:
- `period`: 时间周期（1h、6h、24h、7d、30d）

**响应数据**:
```json
{
  "code": "S",
  "message": "成功",
  "data": {
    "queries": {
      "total": 125000,
      "select": 100000,
      "insert": 15000,
      "update": 8000,
      "delete": 2000
    },
    "avgQueryTime": 15.6,
    "slowQueries": 125,
    "connections": {
      "current": 45,
      "max": 150
    },
    "cacheHitRate": 85.6,
    "history": [
      {
        "time": "2025-12-19 10:00:00",
        "qps": 2500,
        "avgQueryTime": 14.2
      }
    ]
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

## 缓存监控

### 9. 获取Redis监控数据
**接口地址**: `GET /api/v1/monitoring/cache/redis`

**响应数据**:
```json
{
  "code": "S",
  "message": "成功",
  "data": {
    "status": "UP",
    "version": "6.2.6",
    "uptime": "15天 6小时",
    "connectedClients": 125,
    "maxClients": 10000,
    "usedMemory": "2.5 GB",
    "maxMemory": "8 GB",
    "memoryUsagePercent": 31.25,
    "hitRate": 92.5,
    "ops": 5600,
    "keyspaceHits": 125000,
    "keyspaceMisses": 10000
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

## 告警管理

### 10. 获取告警规则列表（分页）
**接口地址**: `GET /api/v1/monitoring/alerts/rules`

**查询参数**:
- `page`: 页码，默认1
- `size`: 每页大小，默认10
- `status`: 状态筛选（启用、禁用）

**响应数据**:
```json
{
  "code": "S",
  "message": "成功",
  "data": {
    "total": "25",
    "list": [
      {
        "tenantId": "1",
        "createdBy": "1000001",
        "creator": "系统管理员",
        "createdDate": "2024-01-15 10:00:00",
        "modifiedBy": "1000001",
        "modifier": "系统管理员",
        "modifiedDate": "2025-12-03 14:30:00",
        "id": "ALERT_RULE_001",
        "name": "CPU使用率告警",
        "metric": "cpu_usage",
        "condition": ">",
        "threshold": 80,
        "duration": 300,
        "level": "高",
        "status": "启用",
        "notifyChannels": ["email", "sms"],
        "triggerCount": 15
      }
    ]
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

### 11. 创建告警规则
**接口地址**: `POST /api/v1/monitoring/alerts/rules`

**请求参数**:
```json
{
  "name": "内存使用率告警",
  "metric": "memory_usage",
  "condition": ">",
  "threshold": 90,
  "duration": 300,
  "level": "高",
  "notifyChannels": ["email", "sms", "slack"]
}
```

**响应数据**: 同告警规则列表中的单项数据

---

### 12. 获取告警记录列表（分页）
**接口地址**: `GET /api/v1/monitoring/alerts/records`

**查询参数**:
- `page`: 页码，默认1
- `size`: 每页大小，默认10
- `level`: 等级筛选（低、中、高）
- `status`: 状态筛选（待处理、已处理、已忽略）
- `startDate`: 开始日期
- `endDate`: 结束日期

**响应数据**:
```json
{
  "code": "S",
  "message": "成功",
  "data": {
    "total": "156",
    "list": [
      {
        "tenantId": "1",
        "createdBy": "SYSTEM",
        "creator": "系统",
        "createdDate": "2025-12-19 10:30:00",
        "modifiedBy": "SYSTEM",
        "modifier": "系统",
        "modifiedDate": "2025-12-19 10:30:00",
        "id": "ALERT_001",
        "ruleId": "ALERT_RULE_001",
        "ruleName": "CPU使用率告警",
        "level": "高",
        "metric": "cpu_usage",
        "currentValue": 85.6,
        "threshold": 80,
        "message": "CPU使用率持续5分钟超过80%",
        "status": "待处理",
        "triggerTime": "2025-12-19 10:30:00",
        "notified": true
      }
    ]
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

### 13. 处理告警记录
**接口地址**: `PATCH /api/v1/monitoring/alerts/records/{id}/handle`

**路径参数**:
- `id`: 告警记录ID

**请求参数**:
```json
{
  "status": "已处理",
  "handleNote": "已扩容服务器资源"
}
```

**响应数据**:
```json
{
  "code": "S",
  "message": "处理成功",
  "data": {
    "id": "ALERT_001",
    "status": "已处理",
    "handledBy": "1000001",
    "handledTime": "2025-12-19 11:00:00",
    "handleNote": "已扩容服务器资源"
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

### 14. 获取系统健康检查
**接口地址**: `GET /api/v1/monitoring/health`

**响应数据**:
```json
{
  "code": "S",
  "message": "成功",
  "data": {
    "status": "UP",
    "components": {
      "database": {
        "status": "UP",
        "responseTime": 15
      },
      "redis": {
        "status": "UP",
        "responseTime": 2
      },
      "diskSpace": {
        "status": "UP",
        "details": {
          "total": "500 GB",
          "free": "205 GB",
          "threshold": "10 GB"
        }
      },
      "eureka": {
        "status": "UP",
        "applications": 12
      }
    }
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

## 错误码说明

| 错误码 | 说明 |
|--------|------|
| MONITOR_001 | 监控数据不存在 |
| MONITOR_002 | 告警规则不存在 |
| MONITOR_003 | 告警记录不存在 |
| MONITOR_004 | 监控指标不支持 |
| MONITOR_005 | 时间周期参数错误 |
