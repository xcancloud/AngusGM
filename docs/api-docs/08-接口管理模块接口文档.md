# 接口管理模块 - 后端API接口文档

## 基础信息
- **模块名称**: 接口管理
- **模块路径**: `/api/v1/interfaces`
- **负责功能**: API接口文档管理、接口同步、接口查询

---

## 接口列表

### 1. 获取接口列表（分页）
**接口地址**: `GET /api/v1/interfaces`

**查询参数**:
- `page`: 页码，默认1
- `size`: 每页大小，默认20
- `serviceName`: 服务名称筛选
- `keyword`: 搜索关键词（接口路径、描述）
- `method`: 请求方法筛选（GET、POST、PUT、DELETE、PATCH）
- `tags`: 标签筛选
- `deprecated`: 是否已废弃

**请求示例**:
```
GET /api/v1/interfaces?page=1&size=20&serviceName=ANGUS-GM-SERVICE&method=GET
```

**响应数据**:
```json
{
  "code": "S",
  "message": "成功",
  "data": {
    "total": "125",
    "list": [
      {
        "id": "gm-001",
        "serviceName": "ANGUS-GM-SERVICE",
        "code": "GM001",
        "path": "/api/v1/users",
        "method": "GET",
        "summary": "获取用户列表",
        "description": "分页查询系统用户列表，支持多条件筛选",
        "tags": ["用户管理"],
        "deprecated": false,
        "version": "1.0.0"
      },
      {
        "id": "gm-002",
        "serviceName": "ANGUS-GM-SERVICE",
        "code": "GM002",
        "path": "/api/v1/users",
        "method": "POST",
        "summary": "创建用户",
        "description": "创建新的系统用户",
        "tags": ["用户管理"],
        "deprecated": false,
        "version": "1.0.0"
      }
    ]
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

### 2. 获取接口详情
**接口地址**: `GET /api/v1/interfaces/{id}`

**路径参数**:
- `id`: 接口ID

**响应数据**:
```json
{
  "code": "S",
  "message": "成功",
  "data": {
    "id": "gm-001",
    "serviceName": "ANGUS-GM-SERVICE",
    "displayName": "AngusGM全局管理服务",
    "code": "GM001",
    "path": "/api/v1/users",
    "method": "GET",
    "summary": "获取用户列表",
    "description": "分页查询系统用户列表，支持多条件筛选",
    "tags": ["用户管理"],
    "parameters": [
      {
        "name": "page",
        "type": "integer",
        "required": false,
        "description": "页码，从1开始",
        "in": "query",
        "default": 1
      },
      {
        "name": "size",
        "type": "integer",
        "required": false,
        "description": "每页大小",
        "in": "query",
        "default": 10
      },
      {
        "name": "keyword",
        "type": "string",
        "required": false,
        "description": "搜索关键词",
        "in": "query"
      },
      {
        "name": "status",
        "type": "string",
        "required": false,
        "description": "用户状态",
        "in": "query",
        "enum": ["已激活", "已禁用", "待审核"]
      }
    ],
    "responses": {
      "200": {
        "description": "成功返回用户列表",
        "schema": {
          "type": "object",
          "properties": {
            "code": "string",
            "message": "string",
            "data": {
              "total": "string",
              "list": "array"
            }
          }
        }
      },
      "401": {
        "description": "未授权"
      },
      "500": {
        "description": "服务器错误"
      }
    },
    "deprecated": false,
    "version": "1.0.0",
    "lastSyncTime": "2024-12-19 14:30:25"
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

### 3. 同步服务接口
**接口地址**: `POST /api/v1/interfaces/sync`

**请求参数**:
```json
{
  "serviceName": "ANGUS-GM-SERVICE"
}
```

**响应数据**:
```json
{
  "code": "S",
  "message": "同步成功",
  "data": {
    "serviceName": "ANGUS-GM-SERVICE",
    "syncTime": "2025-12-19 15:00:00",
    "totalInterfaces": 125,
    "newInterfaces": 5,
    "updatedInterfaces": 8,
    "deprecatedInterfaces": 2
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

### 4. 批量同步所有服务接口
**接口地址**: `POST /api/v1/interfaces/sync-all`

**响应数据**:
```json
{
  "code": "S",
  "message": "批量同步成功",
  "data": {
    "syncTime": "2025-12-19 15:00:00",
    "totalServices": 12,
    "totalInterfaces": 456,
    "newInterfaces": 23,
    "updatedInterfaces": 45,
    "deprecatedInterfaces": 8,
    "services": [
      {
        "serviceName": "ANGUS-GM-SERVICE",
        "interfaceCount": 125
      },
      {
        "serviceName": "ANGUS-AUTH-SERVICE",
        "interfaceCount": 45
      }
    ]
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

### 5. 获取服务的接口列表
**接口地址**: `GET /api/v1/interfaces/service/{serviceName}`

**路径参数**:
- `serviceName`: 服务名称

**查询参数**:
- `page`: 页码，默认1
- `size`: 每页大小，默认20

**响应数据**: 同获取接口列表

---

### 6. 按标签获取接口列表
**接口地址**: `GET /api/v1/interfaces/tag/{tag}`

**路径参数**:
- `tag`: 标签名称

**查询参数**:
- `page`: 页码，默认1
- `size`: 每页大小，默认20

**响应数据**: 同获取接口列表

---

### 7. 获取所有服务列表（带接口数量）
**接口地址**: `GET /api/v1/interfaces/services`

**响应数据**:
```json
{
  "code": "S",
  "message": "成功",
  "data": [
    {
      "serviceName": "ANGUS-GM-SERVICE",
      "displayName": "AngusGM全局管理服务",
      "version": "1.0.0",
      "baseUrl": "http://192.168.1.101:8080",
      "syncTime": "2024-12-19 14:30:25",
      "interfaceCount": 125
    },
    {
      "serviceName": "ANGUS-AUTH-SERVICE",
      "displayName": "AngusAI认证服务",
      "version": "2.1.0",
      "baseUrl": "http://192.168.1.201:9090",
      "syncTime": "2024-12-19 14:30:20",
      "interfaceCount": 45
    }
  ],
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

### 8. 获取所有标签列表（带接口数量）
**接口地址**: `GET /api/v1/interfaces/tags`

**响应数据**:
```json
{
  "code": "S",
  "message": "成功",
  "data": [
    {
      "name": "用户管理",
      "interfaceCount": 25
    },
    {
      "name": "租户管理",
      "interfaceCount": 18
    },
    {
      "name": "部门管理",
      "interfaceCount": 15
    },
    {
      "name": "权限管理",
      "interfaceCount": 20
    }
  ],
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

### 9. 标记接口为废弃
**接口地址**: `PATCH /api/v1/interfaces/{id}/deprecate`

**路径参数**:
- `id`: 接口ID

**请求参数**:
```json
{
  "deprecated": true,
  "deprecationNote": "该接口已废弃，请使用新版本接口 /api/v2/users"
}
```

**响应数据**:
```json
{
  "code": "S",
  "message": "标记成功",
  "data": {
    "id": "gm-001",
    "deprecated": true,
    "deprecationNote": "该接口已废弃，请使用新版本接口 /api/v2/users",
    "modifiedDate": "2025-12-19 15:10:00"
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

### 10. 获取接口调用统计
**接口地址**: `GET /api/v1/interfaces/{id}/stats`

**路径参数**:
- `id`: 接口ID

**查询参数**:
- `startDate`: 开始日期
- `endDate`: 结束日期

**响应数据**:
```json
{
  "code": "S",
  "message": "成功",
  "data": {
    "interfaceId": "gm-001",
    "path": "/api/v1/users",
    "method": "GET",
    "period": {
      "startDate": "2025-12-12",
      "endDate": "2025-12-19"
    },
    "totalRequests": 50000,
    "successRequests": 49500,
    "failedRequests": 500,
    "avgResponseTime": 125,
    "maxResponseTime": 1500,
    "minResponseTime": 50,
    "requestsPerDay": [
      {
        "date": "2025-12-12",
        "count": 7500
      },
      {
        "date": "2025-12-13",
        "count": 7200
      }
    ],
    "errorCodes": [
      {
        "code": 401,
        "count": 300
      },
      {
        "code": 500,
        "count": 200
      }
    ]
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

## 错误码说明

| 错误码 | 说明 |
|--------|------|
| INTERFACE_001 | 接口不存在 |
| INTERFACE_002 | 服务不存在 |
| INTERFACE_003 | 同步失败 |
| INTERFACE_004 | 接口文档格式错误 |
