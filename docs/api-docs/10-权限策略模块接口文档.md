# 权限策略（角色）模块 - 后端API接口文档

## 基础信息
- **模块名称**: 权限策略（角色管理）
- **模块路径**: `/api/v1/roles`
- **负责功能**: 角色的增删改查、权限配置、用户分配

---

## 接口列表

### 1. 获取角色统计数据
**接口地址**: `GET /api/v1/roles/stats`

**响应数据**:
```json
{
  "code": "S",
  "message": "成功",
  "data": {
    "totalRoles": 15,
    "systemRoles": 4,
    "customRoles": 11,
    "totalUsers": 456
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

### 2. 获取角色列表（分页）
**接口地址**: `GET /api/v1/roles`

**查询参数**:
- `page`: 页码，默认1
- `size`: 每页大小，默认10
- `keyword`: 搜索关键词（名称、编码）
- `appId`: 应用ID筛选
- `isSystem`: 是否系统角色
- `isDefault`: 是否默认角色

**请求示例**:
```
GET /api/v1/roles?page=1&size=10&keyword=管理员&appId=app-gm
```

**响应数据**:
```json
{
  "code": "S",
  "message": "成功",
  "data": {
    "total": "15",
    "list": [
      {
        "tenantId": "1",
        "createdBy": "1000001",
        "creator": "系统",
        "createdDate": "2024-01-01 00:00:00",
        "modifiedBy": "1000001",
        "modifier": "系统",
        "modifiedDate": "2024-01-01 00:00:00",
        "id": "1",
        "name": "系统管理员",
        "code": "SYSTEM_ADMIN",
        "description": "系统最高权限，拥有所有管理功能",
        "isSystem": true,
        "isDefault": false,
        "userCount": 3,
        "appId": "app-gm",
        "appName": "AngusGM"
      },
      {
        "tenantId": "1",
        "createdBy": "1000001",
        "creator": "系统",
        "createdDate": "2024-01-01 00:00:00",
        "modifiedBy": "1000001",
        "modifier": "系统",
        "modifiedDate": "2024-01-01 00:00:00",
        "id": "2",
        "name": "租户管理员",
        "code": "TENANT_ADMIN",
        "description": "租户级别管理员，管理租户内所有资源",
        "isSystem": true,
        "isDefault": false,
        "userCount": 5,
        "appId": "app-gm",
        "appName": "AngusGM"
      }
    ]
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

### 3. 创建角色
**接口地址**: `POST /api/v1/roles`

**请求参数**:
```json
{
  "name": "项目经理",
  "code": "PROJECT_MANAGER",
  "description": "项目管理权限，管理项目和团队",
  "appId": "app-workflow",
  "isDefault": false,
  "permissions": [
    {
      "resource": "projects",
      "actions": ["create", "read", "update", "delete"]
    },
    {
      "resource": "tasks",
      "actions": ["create", "read", "update", "delete"]
    },
    {
      "resource": "team",
      "actions": ["read", "update"]
    }
  ]
}
```

**响应数据**:
```json
{
  "code": "S",
  "message": "创建成功",
  "data": {
    "tenantId": "1",
    "createdBy": "1000001",
    "creator": "柳小龙",
    "createdDate": "2025-12-19 10:30:00",
    "modifiedBy": "1000001",
    "modifier": "柳小龙",
    "modifiedDate": "2025-12-19 10:30:00",
    "id": "100",
    "name": "项目经理",
    "code": "PROJECT_MANAGER",
    "description": "项目管理权限，管理项目和团队",
    "isSystem": false,
    "isDefault": false,
    "userCount": 0,
    "appId": "app-workflow",
    "appName": "AngusFlow",
    "permissions": [
      {
        "resource": "projects",
        "resourceName": "项目",
        "actions": ["create", "read", "update", "delete"]
      },
      {
        "resource": "tasks",
        "resourceName": "任务",
        "actions": ["create", "read", "update", "delete"]
      },
      {
        "resource": "team",
        "resourceName": "团队",
        "actions": ["read", "update"]
      }
    ]
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

### 4. 获取角色详情
**接口地址**: `GET /api/v1/roles/{id}`

**路径参数**:
- `id`: 角色ID

**响应数据**:
```json
{
  "code": "S",
  "message": "成功",
  "data": {
    "tenantId": "1",
    "createdBy": "1000001",
    "creator": "系统",
    "createdDate": "2024-01-01 00:00:00",
    "modifiedBy": "1000001",
    "modifier": "系统",
    "modifiedDate": "2024-01-01 00:00:00",
    "id": "1",
    "name": "系统管理员",
    "code": "SYSTEM_ADMIN",
    "description": "系统最高权限，拥有所有管理功能",
    "isSystem": true,
    "isDefault": false,
    "userCount": 3,
    "appId": "app-gm",
    "appName": "AngusGM",
    "permissions": [
      {
        "resource": "users",
        "resourceName": "用户管理",
        "actions": ["create", "read", "update", "delete"]
      },
      {
        "resource": "tenants",
        "resourceName": "租户管理",
        "actions": ["create", "read", "update", "delete"]
      },
      {
        "resource": "departments",
        "resourceName": "部门管理",
        "actions": ["create", "read", "update", "delete"]
      }
    ],
    "users": [
      {
        "id": "U000",
        "name": "系统管理员",
        "email": "admin@angusgm.com",
        "avatar": "https://avatar.url"
      }
    ]
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

### 5. 更新角色
**接口地址**: `PUT /api/v1/roles/{id}`

**路径参数**:
- `id`: 角色ID

**请求参数**:
```json
{
  "name": "高级项目经理",
  "description": "高级项目管理权限",
  "isDefault": false,
  "permissions": [
    {
      "resource": "projects",
      "actions": ["create", "read", "update", "delete", "export"]
    },
    {
      "resource": "tasks",
      "actions": ["create", "read", "update", "delete"]
    }
  ]
}
```

**响应数据**: 同创建角色（返回完整角色信息）

---

### 6. 删除角色
**接口地址**: `DELETE /api/v1/roles/{id}`

**路径参数**:
- `id`: 角色ID

**响应**: HTTP 204 No Content（无响应体）

---

### 7. 获取角色权限配置
**接口地址**: `GET /api/v1/roles/{id}/permissions`

**路径参数**:
- `id`: 角色ID

**响应数据**:
```json
{
  "code": "S",
  "message": "成功",
  "data": {
    "roleId": "1",
    "roleName": "系统管理员",
    "permissions": [
      {
        "resource": "users",
        "resourceName": "用户管理",
        "actions": ["create", "read", "update", "delete"],
        "description": "用户的增删改查权限"
      },
      {
        "resource": "tenants",
        "resourceName": "租户管理",
        "actions": ["create", "read", "update", "delete"],
        "description": "租户的增删改查权限"
      }
    ]
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

### 8. 更新角色权限
**接口地址**: `PUT /api/v1/roles/{id}/permissions`

**路径参数**:
- `id`: 角色ID

**请求参数**:
```json
{
  "permissions": [
    {
      "resource": "projects",
      "actions": ["create", "read", "update", "delete"]
    },
    {
      "resource": "tasks",
      "actions": ["read", "update"]
    }
  ]
}
```

**响应数据**:
```json
{
  "code": "S",
  "message": "权限更新成功",
  "data": {
    "roleId": "100",
    "roleName": "项目经理",
    "permissions": [
      {
        "resource": "projects",
        "resourceName": "项目",
        "actions": ["create", "read", "update", "delete"]
      },
      {
        "resource": "tasks",
        "resourceName": "任务",
        "actions": ["read", "update"]
      }
    ],
    "modifiedDate": "2025-12-19 11:00:00"
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

### 9. 获取角色的用户列表
**接口地址**: `GET /api/v1/roles/{id}/users`

**路径参数**:
- `id`: 角色ID

**查询参数**:
- `page`: 页码，默认1
- `size`: 每页大小，默认10

**响应数据**:
```json
{
  "code": "S",
  "message": "成功",
  "data": {
    "total": "3",
    "list": [
      {
        "tenantId": "1",
        "createdBy": "1000001",
        "creator": "系统管理员",
        "createdDate": "2024-01-01 00:00:00",
        "modifiedBy": "1000001",
        "modifier": "系统管理员",
        "modifiedDate": "2025-12-03 10:30:00",
        "id": "U000",
        "name": "系统管理员",
        "email": "admin@angusgm.com",
        "avatar": "https://avatar.url",
        "department": "系统管理",
        "status": "已激活"
      }
    ]
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

### 10. 设置为默认角色
**接口地址**: `PATCH /api/v1/roles/{id}/default`

**路径参数**:
- `id`: 角色ID

**请求参数**:
```json
{
  "isDefault": true
}
```

**响应数据**:
```json
{
  "code": "S",
  "message": "设置成功",
  "data": {
    "id": "4",
    "name": "普通用户",
    "isDefault": true,
    "modifiedDate": "2025-12-19 11:00:00"
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

### 11. 获取可用资源和操作列表
**接口地址**: `GET /api/v1/roles/available-permissions`

**查询参数**:
- `appId`: 应用ID

**响应数据**:
```json
{
  "code": "S",
  "message": "成功",
  "data": [
    {
      "resource": "users",
      "resourceName": "用户管理",
      "description": "用户的增删改查",
      "actions": [
        {
          "action": "create",
          "name": "创建"
        },
        {
          "action": "read",
          "name": "查看"
        },
        {
          "action": "update",
          "name": "编辑"
        },
        {
          "action": "delete",
          "name": "删除"
        }
      ]
    },
    {
      "resource": "tenants",
      "resourceName": "租户管理",
      "description": "租户的增删改查",
      "actions": [
        {
          "action": "create",
          "name": "创建"
        },
        {
          "action": "read",
          "name": "查看"
        },
        {
          "action": "update",
          "name": "编辑"
        },
        {
          "action": "delete",
          "name": "删除"
        }
      ]
    }
  ],
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

## 错误码说明

| 错误码 | 说明 |
|--------|------|
| ROLE_001 | 角色编码已存在 |
| ROLE_002 | 角色不存在 |
| ROLE_003 | 系统角色不能删除 |
| ROLE_004 | 角色下存在用户，无法删除 |
| ROLE_005 | 默认角色不能删除 |
| ROLE_006 | 每个应用只能有一个默认角色 |
