# 授权管理模块 - 后端API接口文档

## 基础信息
- **模块名称**: 授权管理
- **模块路径**: `/api/v1/authorizations`
- **负责功能**: 用户/部门/组的角色授权管理

---

## 接口列表

### 1. 获取授权记录列表（分页）
**接口地址**: `GET /api/v1/authorizations`

**查询参数**:
- `page`: 页码，默认1
- `size`: 每页大小，默认10
- `targetType`: 目标类型（user、department、group）
- `appId`: 应用ID筛选
- `roleId`: 角色ID筛选
- `keyword`: 搜索关键词

**请求示例**:
```
GET /api/v1/authorizations?page=1&size=10&targetType=user&appId=app-gm
```

**响应数据**:
```json
{
  "code": "S",
  "message": "成功",
  "data": {
    "total": "156",
    "list": [
      {
        "tenantId": "1",
        "createdBy": "1000001",
        "creator": "系统管理员",
        "createdDate": "2025-11-20 10:30:00",
        "modifiedBy": "1000001",
        "modifier": "系统管理员",
        "modifiedDate": "2025-12-03 14:30:00",
        "id": "AUTH001",
        "targetType": "user",
        "targetId": "U001",
        "targetName": "张伟",
        "targetAvatar": "https://avatar.url/zhangwei.png",
        "targetDepartment": "技术部",
        "targetEmail": "zhangwei@example.com",
        "roles": [
          {
            "id": "2",
            "name": "租户管理员",
            "code": "TENANT_ADMIN",
            "appId": "app-gm",
            "appName": "AngusGM"
          },
          {
            "id": "3",
            "name": "部门管理员",
            "code": "DEPT_ADMIN",
            "appId": "app-gm",
            "appName": "AngusGM"
          }
        ]
      }
    ]
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

### 2. 获取用户授权列表
**接口地址**: `GET /api/v1/authorizations/users`

**查询参数**:
- `page`: 页码，默认1
- `size`: 每页大小，默认10
- `appId`: 应用ID筛选
- `roleId`: 角色ID筛选
- `keyword`: 搜索关键词

**响应数据**: 同获取授权记录列表（targetType固定为user）

---

### 3. 获取部门授权列表
**接口地址**: `GET /api/v1/authorizations/departments`

**查询参数**: 同获取用户授权列表

**响应数据**:
```json
{
  "code": "S",
  "message": "成功",
  "data": {
    "total": "25",
    "list": [
      {
        "tenantId": "1",
        "createdBy": "1000001",
        "creator": "系统管理员",
        "createdDate": "2025-11-20 10:30:00",
        "modifiedBy": "1000001",
        "modifier": "系统管理员",
        "modifiedDate": "2025-12-03 14:30:00",
        "id": "AUTH100",
        "targetType": "department",
        "targetId": "D001",
        "targetName": "技术部",
        "targetParent": "研发中心",
        "targetUserCount": 45,
        "roles": [
          {
            "id": "4",
            "name": "普通用户",
            "code": "NORMAL_USER",
            "appId": "app-ai",
            "appName": "AngusAI"
          }
        ]
      }
    ]
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

### 4. 获取组授权列表
**接口地址**: `GET /api/v1/authorizations/groups`

**查询参数**: 同获取用户授权列表

**响应数据**:
```json
{
  "code": "S",
  "message": "成功",
  "data": {
    "total": "18",
    "list": [
      {
        "tenantId": "1",
        "createdBy": "1000001",
        "creator": "系统管理员",
        "createdDate": "2025-11-20 10:30:00",
        "modifiedBy": "1000001",
        "modifier": "系统管理员",
        "modifiedDate": "2025-12-03 14:30:00",
        "id": "AUTH200",
        "targetType": "group",
        "targetId": "G001",
        "targetName": "AngusGM项目组",
        "targetDescription": "负责AngusGM平台的开发和维护",
        "targetUserCount": 12,
        "roles": [
          {
            "id": "5",
            "name": "项目经理",
            "code": "PROJECT_MANAGER",
            "appId": "app-workflow",
            "appName": "AngusFlow"
          }
        ]
      }
    ]
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

### 5. 创建授权
**接口地址**: `POST /api/v1/authorizations`

**请求参数**:
```json
{
  "targetType": "user",
  "targetId": "U010",
  "roleIds": ["2", "5"]
}
```

**响应数据**:
```json
{
  "code": "S",
  "message": "授权成功",
  "data": {
    "tenantId": "1",
    "createdBy": "1000001",
    "creator": "系统管理员",
    "createdDate": "2025-12-19 10:30:00",
    "modifiedBy": "1000001",
    "modifier": "系统管理员",
    "modifiedDate": "2025-12-19 10:30:00",
    "id": "AUTH500",
    "targetType": "user",
    "targetId": "U010",
    "targetName": "李明",
    "targetAvatar": "https://avatar.url/liming.png",
    "targetDepartment": "运维部",
    "targetEmail": "liming@example.com",
    "roles": [
      {
        "id": "2",
        "name": "租户管理员",
        "code": "TENANT_ADMIN",
        "appId": "app-gm",
        "appName": "AngusGM"
      },
      {
        "id": "5",
        "name": "项目经理",
        "code": "PROJECT_MANAGER",
        "appId": "app-workflow",
        "appName": "AngusFlow"
      }
    ]
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

### 6. 获取授权详情
**接口地址**: `GET /api/v1/authorizations/{id}`

**路径参数**:
- `id`: 授权ID

**响应数据**: 同创建授权

---

### 7. 更新授权
**接口地址**: `PUT /api/v1/authorizations/{id}`

**路径参数**:
- `id`: 授权ID

**请求参数**:
```json
{
  "roleIds": ["2", "3", "5"]
}
```

**响应数据**: 同创建授权（返回完整授权信息）

---

### 8. 删除授权
**接口地址**: `DELETE /api/v1/authorizations/{id}`

**路径参数**:
- `id`: 授权ID

**响应**: HTTP 204 No Content（无响应体）

---

### 9. 批量授权
**接口地址**: `POST /api/v1/authorizations/batch`

**请求参数**:
```json
{
  "targetType": "user",
  "targetIds": ["U010", "U011", "U012"],
  "roleIds": ["2", "5"]
}
```

**响应数据**:
```json
{
  "code": "S",
  "message": "批量授权成功",
  "data": {
    "targetType": "user",
    "targetCount": 3,
    "roleCount": 2,
    "successCount": 3,
    "failedCount": 0,
    "results": [
      {
        "targetId": "U010",
        "targetName": "用户1",
        "success": true
      },
      {
        "targetId": "U011",
        "targetName": "用户2",
        "success": true
      },
      {
        "targetId": "U012",
        "targetName": "用户3",
        "success": true
      }
    ]
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

### 10. 批量删除授权
**接口地址**: `DELETE /api/v1/authorizations/batch`

**请求参数**:
```json
{
  "authorizationIds": ["AUTH001", "AUTH002", "AUTH003"]
}
```

**响应**: HTTP 204 No Content（无响应体）

---

### 11. 获取指定目标的授权信息
**接口地址**: `GET /api/v1/authorizations/target/{targetType}/{targetId}`

**路径参数**:
- `targetType`: 目标类型（user、department、group）
- `targetId`: 目标ID

**响应数据**:
```json
{
  "code": "S",
  "message": "成功",
  "data": {
    "targetType": "user",
    "targetId": "U010",
    "targetName": "李明",
    "roles": [
      {
        "id": "2",
        "name": "租户管理员",
        "code": "TENANT_ADMIN",
        "appId": "app-gm",
        "appName": "AngusGM"
      }
    ],
    "permissions": [
      "user:read",
      "user:write",
      "tenant:read",
      "tenant:write"
    ]
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

### 12. 添加角色到授权
**接口地址**: `POST /api/v1/authorizations/{id}/roles`

**路径参数**:
- `id`: 授权ID

**请求参数**:
```json
{
  "roleIds": ["6", "7"]
}
```

**响应数据**:
```json
{
  "code": "S",
  "message": "角色添加成功",
  "data": {
    "authorizationId": "AUTH001",
    "addedRoles": [
      {
        "id": "6",
        "name": "开发工程师"
      },
      {
        "id": "7",
        "name": "测试工程师"
      }
    ],
    "modifiedDate": "2025-12-19 11:00:00"
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

### 13. 从授权中移除角色
**接口地址**: `DELETE /api/v1/authorizations/{id}/roles/{roleId}`

**路径参数**:
- `id`: 授权ID
- `roleId`: 角色ID

**响应**: HTTP 204 No Content（无响应体）

---

## 错误码说明

| 错误码 | 说明 |
|--------|------|
| AUTH_001 | 授权不存在 |
| AUTH_002 | 目标不存在 |
| AUTH_003 | 角色不存在 |
| AUTH_004 | 授权已存在 |
| AUTH_005 | 不能移除最后一个角色 |
| AUTH_006 | 角色与目标类型不匹配 |
