# 备份恢复模块 - 后端API接口文档

## 基础信息
- **模块名称**: 备份恢复
- **模块路径**: `/api/v1/backup`
- **负责功能**: 系统备份、恢复、备份计划管理

---

## 接口列表

### 1. 获取备份统计数据
**接口地址**: `GET /api/v1/backup/stats`

**响应数据**:
```json
{
  "code": "S",
  "message": "成功",
  "data": {
    "totalBackups": 156,
    "successBackups": 148,
    "failedBackups": 8,
    "totalSize": "125.5 GB",
    "lastBackupTime": "2024-12-03 02:00:00"
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

### 2. 获取备份记录列表（分页）
**接口地址**: `GET /api/v1/backup/records`

**查询参数**:
- `page`: 页码，默认1
- `size`: 每页大小，默认10
- `keyword`: 搜索关键词
- `type`: 类型筛选（完整备份、增量备份、差异备份）
- `status`: 状态筛选（成功、失败、进行中）
- `startDate`: 开始日期
- `endDate`: 结束日期

**响应数据**:
```json
{
  "code": "S",
  "message": "成功",
  "data": {
    "total": "156",
    "list": [
      {
        "tenantId": "1",
        "createdBy": "SYSTEM",
        "creator": "系统自动",
        "createdDate": "2024-12-03 02:00:00",
        "modifiedBy": "SYSTEM",
        "modifier": "系统自动",
        "modifiedDate": "2024-12-03 02:15:00",
        "id": "BK001",
        "name": "系统完整备份_20241203",
        "type": "完整备份",
        "size": "2.5 GB",
        "status": "成功",
        "description": "每日自动完整备份",
        "path": "/backup/full/20241203_020000.bak",
        "duration": "15分钟",
        "startTime": "2024-12-03 02:00:00",
        "endTime": "2024-12-03 02:15:00"
      },
      {
        "tenantId": "1",
        "createdBy": "1000001",
        "creator": "张管理员",
        "createdDate": "2024-12-02 14:30:00",
        "modifiedBy": "1000001",
        "modifier": "张管理员",
        "modifiedDate": "2024-12-02 14:35:00",
        "id": "BK002",
        "name": "系统增量备份_20241202",
        "type": "增量备份",
        "size": "456 MB",
        "status": "成功",
        "description": "手动增量备份",
        "path": "/backup/incremental/20241202_143000.bak",
        "duration": "5分钟",
        "startTime": "2024-12-02 14:30:00",
        "endTime": "2024-12-02 14:35:00"
      }
    ]
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

### 3. 创建备份
**接口地址**: `POST /api/v1/backup/records`

**请求参数**:
```json
{
  "name": "手动完整备份_20251219",
  "type": "完整备份",
  "description": "重大更新前的完整备份"
}
```

**响应数据**:
```json
{
  "code": "S",
  "message": "备份任务已创建",
  "data": {
    "tenantId": "1",
    "createdBy": "1000001",
    "creator": "柳小龙",
    "createdDate": "2025-12-19 10:30:00",
    "modifiedBy": "1000001",
    "modifier": "柳小龙",
    "modifiedDate": "2025-12-19 10:30:00",
    "id": "BK500",
    "name": "手动完整备份_20251219",
    "type": "完整备份",
    "size": "0 B",
    "status": "进行中",
    "description": "重大更新前的完整备份",
    "path": "/backup/full/20251219_103000.bak",
    "duration": "0分钟",
    "startTime": "2025-12-19 10:30:00",
    "endTime": null
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

### 4. 获取备份详情
**接口地址**: `GET /api/v1/backup/records/{id}`

**路径参数**:
- `id`: 备份ID

**响应数据**: 同备份记录列表中的单项数据，额外包含：
```json
{
  "code": "S",
  "message": "成功",
  "data": {
    "id": "BK001",
    "name": "系统完整备份_20241203",
    "...(其他字段省略)...",
    "backupContent": {
      "database": true,
      "files": true,
      "configurations": true
    },
    "canRestore": true,
    "restoreHistory": [
      {
        "restoreTime": "2024-12-10 15:30:00",
        "restoreBy": "张管理员",
        "restoreStatus": "成功"
      }
    ]
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

### 5. 删除备份
**接口地址**: `DELETE /api/v1/backup/records/{id}`

**路径参数**:
- `id`: 备份ID

**响应**: HTTP 204 No Content（无响应体）

---

### 6. 下载备份文件
**接口地址**: `GET /api/v1/backup/records/{id}/download`

**路径参数**:
- `id`: 备份ID

**响应**: 文件下载流

---

### 7. 恢复备份
**接口地址**: `POST /api/v1/backup/records/{id}/restore`

**路径参数**:
- `id`: 备份ID

**请求参数**:
```json
{
  "restoreDatabase": true,
  "restoreFiles": true,
  "restoreConfigurations": true,
  "confirmOverwrite": true
}
```

**响应数据**:
```json
{
  "code": "S",
  "message": "恢复任务已创建",
  "data": {
    "backupId": "BK001",
    "restoreId": "RESTORE001",
    "status": "进行中",
    "startTime": "2025-12-19 11:00:00"
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

### 8. 获取恢复进度
**接口地址**: `GET /api/v1/backup/restore/{restoreId}/progress`

**路径参数**:
- `restoreId`: 恢复任务ID

**响应数据**:
```json
{
  "code": "S",
  "message": "成功",
  "data": {
    "restoreId": "RESTORE001",
    "status": "进行中",
    "progress": 45,
    "currentStep": "恢复数据库",
    "totalSteps": 3,
    "completedSteps": 1,
    "startTime": "2025-12-19 11:00:00",
    "estimatedEndTime": "2025-12-19 11:20:00"
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

## 备份计划管理

### 9. 获取备份计划列表
**接口地址**: `GET /api/v1/backup/schedules`

**响应数据**:
```json
{
  "code": "S",
  "message": "成功",
  "data": [
    {
      "tenantId": "1",
      "createdBy": "1000001",
      "creator": "系统管理员",
      "createdDate": "2024-01-01 10:00:00",
      "modifiedBy": "1000001",
      "modifier": "系统管理员",
      "modifiedDate": "2025-12-03 14:30:00",
      "id": "SCH001",
      "name": "每日完整备份",
      "type": "完整备份",
      "frequency": "每日",
      "time": "02:00",
      "retention": "30天",
      "status": "启用",
      "lastRun": "2024-12-03 02:00:00",
      "nextRun": "2024-12-04 02:00:00"
    },
    {
      "tenantId": "1",
      "createdBy": "1000001",
      "creator": "系统管理员",
      "createdDate": "2024-01-01 10:00:00",
      "modifiedBy": "1000001",
      "modifier": "系统管理员",
      "modifiedDate": "2025-12-03 14:30:00",
      "id": "SCH002",
      "name": "每周差异备份",
      "type": "差异备份",
      "frequency": "每周",
      "time": "18:00",
      "retention": "60天",
      "status": "启用",
      "lastRun": "2024-11-30 18:00:00",
      "nextRun": "2024-12-07 18:00:00"
    }
  ],
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

### 10. 创建备份计划
**接口地址**: `POST /api/v1/backup/schedules`

**请求参数**:
```json
{
  "name": "每日增量备份",
  "type": "增量备份",
  "frequency": "每日",
  "time": "18:00",
  "retention": "15天",
  "status": "启用"
}
```

**响应数据**: 同备份计划列表中的单项数据

---

### 11. 更新备份计划
**接口地址**: `PUT /api/v1/backup/schedules/{id}`

**路径参数**:
- `id`: 计划ID

**请求参数**: 同创建备份计划

**响应数据**: 同备份计划列表中的单项数据

---

### 12. 删除备份计划
**接口地址**: `DELETE /api/v1/backup/schedules/{id}`

**路径参数**:
- `id`: 计划ID

**响应**: HTTP 204 No Content（无响应体）

---

### 13. 启用/禁用备份计划
**接口地址**: `PATCH /api/v1/backup/schedules/{id}/status`

**路径参数**:
- `id`: 计划ID

**请求参数**:
```json
{
  "status": "禁用"
}
```

**响应数据**:
```json
{
  "code": "S",
  "message": "状态更新成功",
  "data": {
    "id": "SCH001",
    "status": "禁用",
    "modifiedDate": "2025-12-19 11:00:00"
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

### 14. 立即执行备份计划
**接口地址**: `POST /api/v1/backup/schedules/{id}/run`

**路径参数**:
- `id`: 计划ID

**响应数据**:
```json
{
  "code": "S",
  "message": "备份任务已启动",
  "data": {
    "scheduleId": "SCH001",
    "backupId": "BK600",
    "startTime": "2025-12-19 11:00:00"
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

## 错误码说明

| 错误码 | 说明 |
|--------|------|
| BACKUP_001 | 备份记录不存在 |
| BACKUP_002 | 备份正在进行中 |
| BACKUP_003 | 备份文件不存在 |
| BACKUP_004 | 恢复失败 |
| BACKUP_005 | 备份计划不存在 |
| BACKUP_006 | 存储空间不足 |
