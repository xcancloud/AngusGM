# 短信消息模块 - 后端API接口文档

## 基础信息
- **模块名称**: 短信消息
- **模块路径**: `/api/v1/sms`
- **负责功能**: 短信发送、模板管理、发送记录查询

---

## 接口列表

### 1. 获取短信统计数据
**接口地址**: `GET /api/v1/sms/stats`

**响应数据**:
```json
{
  "code": "S",
  "message": "成功",
  "data": {
    "totalSent": 12580,
    "successCount": 12340,
    "failedCount": 240,
    "todaySent": 156,
    "thisMonthSent": 4520,
    "balance": 8500
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

### 2. 获取短信记录列表（分页）
**接口地址**: `GET /api/v1/sms/records`

**查询参数**:
- `page`: 页码，默认1
- `size`: 每页大小，默认10
- `keyword`: 搜索关键词（手机号、内容）
- `status`: 状态筛选（成功、失败、待发送）
- `templateId`: 模板ID筛选
- `startDate`: 开始日期
- `endDate`: 结束日期

**响应数据**:
```json
{
  "code": "S",
  "message": "成功",
  "data": {
    "total": "12580",
    "list": [
      {
        "tenantId": "1",
        "createdBy": "SYSTEM",
        "creator": "系统自动",
        "createdDate": "2025-12-19 10:30:00",
        "modifiedBy": "SYSTEM",
        "modifier": "系统自动",
        "modifiedDate": "2025-12-19 10:30:01",
        "id": "SMS001",
        "phone": "138****1234",
        "content": "【AngusGM】您的验证码是：123456，5分钟内有效，请勿泄露。",
        "templateId": "TPL001",
        "templateName": "登录验证码",
        "status": "成功",
        "sentTime": "2025-12-19 10:30:00",
        "deliveredTime": "2025-12-19 10:30:01",
        "provider": "阿里云",
        "cost": 0.05
      }
    ]
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

### 3. 发送单条短信
**接口地址**: `POST /api/v1/sms/send`

**请求参数**:
```json
{
  "phone": "13800138000",
  "templateId": "TPL001",
  "params": {
    "code": "123456"
  }
}
```

**响应数据**:
```json
{
  "code": "S",
  "message": "发送成功",
  "data": {
    "tenantId": "1",
    "createdBy": "1000001",
    "creator": "柳小龙",
    "createdDate": "2025-12-19 10:30:00",
    "modifiedBy": "1000001",
    "modifier": "柳小龙",
    "modifiedDate": "2025-12-19 10:30:01",
    "id": "SMS100",
    "phone": "138****8000",
    "content": "【AngusGM】您的验证码是：123456，5分钟内有效，请勿泄露。",
    "templateId": "TPL001",
    "status": "成功",
    "sentTime": "2025-12-19 10:30:00",
    "messageId": "msg-abc123"
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

### 4. 批量发送短信
**接口地址**: `POST /api/v1/sms/send-batch`

**请求参数**:
```json
{
  "phones": ["13800138000", "13900139000", "13700137000"],
  "templateId": "TPL002",
  "params": {
    "name": "用户",
    "event": "系统维护"
  }
}
```

**响应数据**:
```json
{
  "code": "S",
  "message": "批量发送成功",
  "data": {
    "totalCount": 3,
    "successCount": 3,
    "failedCount": 0,
    "results": [
      {
        "phone": "138****8000",
        "status": "成功",
        "messageId": "msg-abc123"
      },
      {
        "phone": "139****9000",
        "status": "成功",
        "messageId": "msg-abc124"
      },
      {
        "phone": "137****7000",
        "status": "成功",
        "messageId": "msg-abc125"
      }
    ]
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

### 5. 获取短信模板列表（分页）
**接口地址**: `GET /api/v1/sms/templates`

**查询参数**:
- `page`: 页码，默认1
- `size`: 每页大小，默认10
- `keyword`: 搜索关键词
- `status`: 状态筛选（已启用、已禁用）
- `type`: 类型筛选（验证码、通知、营销）

**响应数据**:
```json
{
  "code": "S",
  "message": "成功",
  "data": {
    "total": "25",
    "list": [
      {
        "tenantId": "1",
        "createdBy": "1000001",
        "creator": "系统管理员",
        "createdDate": "2024-01-15 10:00:00",
        "modifiedBy": "1000001",
        "modifier": "系统管理员",
        "modifiedDate": "2025-12-03 14:30:00",
        "id": "TPL001",
        "name": "登录验证码",
        "code": "LOGIN_VERIFY_CODE",
        "type": "验证码",
        "content": "【AngusGM】您的验证码是：{code}，5分钟内有效，请勿泄露。",
        "params": ["code"],
        "status": "已启用",
        "usageCount": 1250,
        "provider": "阿里云",
        "templateCode": "SMS_123456789"
      }
    ]
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

### 6. 创建短信模板
**接口地址**: `POST /api/v1/sms/templates`

**请求参数**:
```json
{
  "name": "系统通知模板",
  "code": "SYSTEM_NOTIFY",
  "type": "通知",
  "content": "【AngusGM】尊敬的{name}，{event}将于{time}进行，请知悉。",
  "params": ["name", "event", "time"],
  "provider": "阿里云",
  "templateCode": "SMS_987654321"
}
```

**响应数据**: 同短信模板列表中的单项数据

---

### 7. 更新短信模板
**接口地址**: `PUT /api/v1/sms/templates/{id}`

**路径参数**:
- `id`: 模板ID

**请求参数**: 同创建短信模板

**响应数据**: 同短信模板列表中的单项数据

---

### 8. 删除短信模板
**接口地址**: `DELETE /api/v1/sms/templates/{id}`

**路径参数**:
- `id`: 模板ID

**响应**: HTTP 204 No Content（无响应体）

---

### 9. 启用/禁用短信模板
**接口地址**: `PATCH /api/v1/sms/templates/{id}/status`

**路径参数**:
- `id`: 模板ID

**请求参数**:
```json
{
  "status": "已禁用"
}
```

**响应数据**:
```json
{
  "code": "S",
  "message": "状态更新成功",
  "data": {
    "id": "TPL001",
    "status": "已禁用",
    "modifiedDate": "2025-12-19 11:00:00"
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

### 10. 获取短信服务商配置
**接口地址**: `GET /api/v1/sms/providers`

**响应数据**:
```json
{
  "code": "S",
  "message": "成功",
  "data": [
    {
      "tenantId": "1",
      "createdBy": "1000001",
      "creator": "系统管理员",
      "createdDate": "2024-01-15 10:00:00",
      "modifiedBy": "1000001",
      "modifier": "系统管理员",
      "modifiedDate": "2025-12-03 14:30:00",
      "id": "PROV001",
      "name": "阿里云短信",
      "code": "ALIYUN",
      "isDefault": true,
      "isEnabled": true,
      "config": {
        "accessKeyId": "LTAI****",
        "accessKeySecret": "****",
        "signName": "AngusGM",
        "endpoint": "dysmsapi.aliyuncs.com"
      },
      "balance": 8500,
      "monthlyQuota": 10000
    }
  ],
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

### 11. 创建服务商配置
**接口地址**: `POST /api/v1/sms/providers`

**请求参数**:
```json
{
  "name": "腾讯云短信",
  "code": "TENCENT",
  "isDefault": false,
  "config": {
    "secretId": "AKIDxxxx",
    "secretKey": "xxxx",
    "sdkAppId": "1400xxx",
    "signName": "AngusGM"
  }
}
```

**响应数据**: 同服务商配置列表中的单项数据

---

### 12. 测试短信发送
**接口地址**: `POST /api/v1/sms/test`

**请求参数**:
```json
{
  "phone": "13800138000",
  "content": "这是一条测试短信"
}
```

**响应数据**:
```json
{
  "code": "S",
  "message": "测试发送成功",
  "data": {
    "phone": "138****8000",
    "status": "成功",
    "messageId": "test-msg-123",
    "sentTime": "2025-12-19 11:00:00"
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

## 错误码说明

| 错误码 | 说明 |
|--------|------|
| SMS_001 | 短信模板不存在 |
| SMS_002 | 手机号格式错误 |
| SMS_003 | 短信余额不足 |
| SMS_004 | 发送频率过快 |
| SMS_005 | 服务商配置错误 |
| SMS_006 | 模板参数缺失 |
| SMS_007 | 超过每日发送限制 |
