# 消息通知模块 - 后端API接口文档

## 基础信息
- **模块名称**: 消息通知
- **模块路径**: `/api/v1/notifications`
- **负责功能**: 系统通知的查看、管理、通知配置

---

## 接口列表

### 1. 获取通知统计数据
**接口地址**: `GET /api/v1/notifications/stats`

**响应数据**:
```json
{
  "code": "S",
  "message": "成功",
  "data": {
    "totalNotifications": 156,
    "unreadNotifications": 28,
    "starredNotifications": 12,
    "archivedNotifications": 45
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

### 2. 获取通知列表（分页）
**接口地址**: `GET /api/v1/notifications`

**查询参数**:
- `page`: 页码，默认1
- `size`: 每页大小，默认10
- `keyword`: 搜索关键词
- `category`: 分类筛选（all、unread、starred、archived）
- `source`: 来源筛选
- `status`: 状态筛选（success、warning、error、info）

**请求示例**:
```
GET /api/v1/notifications?page=1&size=10&category=unread&status=warning
```

**响应数据**:
```json
{
  "code": "S",
  "message": "成功",
  "data": {
    "total": "156",
    "list": [
      {
        "tenantId": "1",
        "createdBy": "SYSTEM",
        "creator": "系统",
        "createdDate": "2024-12-03 15:30:00",
        "modifiedBy": "SYSTEM",
        "modifier": "系统",
        "modifiedDate": "2024-12-03 15:30:00",
        "id": "NOTIF001",
        "title": "租户 TechFlow Inc 升级为企业版",
        "content": "租户 TechFlow Inc 已成功从社区版升级至企业版。新增100+用户授权，月费用提加至 ¥4,999。",
        "source": "Subscription Service",
        "category": "all",
        "status": "success",
        "isRead": false,
        "isStarred": false,
        "isArchived": false,
        "time": "2024-12-03 15:30:00",
        "tags": ["订阅", "升级"]
      },
      {
        "tenantId": "1",
        "createdBy": "SYSTEM",
        "creator": "系统",
        "createdDate": "2024-12-03 13:45:00",
        "modifiedBy": "SYSTEM",
        "modifier": "系统",
        "modifiedDate": "2024-12-03 13:45:00",
        "id": "NOTIF002",
        "title": "账单支付超期警告：CloudNet Systems",
        "content": "CloudNet Systems 的 ¥4,999 账单已逾期7天未支付。系统已发送第二次催款邮件。建议人工跟进。",
        "source": "Billing System",
        "category": "unread",
        "status": "error",
        "isRead": false,
        "isStarred": true,
        "isArchived": false,
        "time": "2024-12-03 13:45:00",
        "tags": ["账单", "警告"]
      }
    ]
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

### 3. 获取通知详情
**接口地址**: `GET /api/v1/notifications/{id}`

**路径参数**:
- `id`: 通知ID

**响应数据**:
```json
{
  "code": "S",
  "message": "成功",
  "data": {
    "tenantId": "1",
    "createdBy": "SYSTEM",
    "creator": "系统",
    "createdDate": "2024-12-03 15:30:00",
    "modifiedBy": "SYSTEM",
    "modifier": "系统",
    "modifiedDate": "2024-12-03 15:30:00",
    "id": "NOTIF001",
    "title": "租户 TechFlow Inc 升级为企业版",
    "content": "租户 TechFlow Inc 已成功从社区版升级至企业版。新增100+用户授权，月费用提加至 ¥4,999。",
    "source": "Subscription Service",
    "category": "all",
    "status": "success",
    "isRead": true,
    "isStarred": false,
    "isArchived": false,
    "time": "2024-12-03 15:30:00",
    "tags": ["订阅", "升级"],
    "metadata": {
      "tenantId": "T002",
      "tenantName": "TechFlow Inc",
      "oldPlan": "社区版",
      "newPlan": "企业版"
    }
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

### 4. 标记通知为已读
**接口地址**: `PATCH /api/v1/notifications/{id}/read`

**路径参数**:
- `id`: 通知ID

**响应数据**:
```json
{
  "code": "S",
  "message": "标记成功",
  "data": {
    "id": "NOTIF001",
    "isRead": true,
    "readTime": "2025-12-19 11:00:00"
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

### 5. 批量标记为已读
**接口地址**: `PATCH /api/v1/notifications/read-batch`

**请求参数**:
```json
{
  "notificationIds": ["NOTIF001", "NOTIF002", "NOTIF003"]
}
```

**响应数据**:
```json
{
  "code": "S",
  "message": "批量标记成功",
  "data": {
    "count": 3,
    "readTime": "2025-12-19 11:00:00"
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

### 6. 全部标记为已读
**接口地址**: `PATCH /api/v1/notifications/read-all`

**响应数据**:
```json
{
  "code": "S",
  "message": "全部已读",
  "data": {
    "count": 28,
    "readTime": "2025-12-19 11:00:00"
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

### 7. 收藏/取消收藏通知
**接口地址**: `PATCH /api/v1/notifications/{id}/star`

**路径参数**:
- `id`: 通知ID

**请求参数**:
```json
{
  "isStarred": true
}
```

**响应数据**:
```json
{
  "code": "S",
  "message": "操作成功",
  "data": {
    "id": "NOTIF001",
    "isStarred": true
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

### 8. 归档/取消归档通知
**接口地址**: `PATCH /api/v1/notifications/{id}/archive`

**路径参数**:
- `id`: 通知ID

**请求参数**:
```json
{
  "isArchived": true
}
```

**响应数据**:
```json
{
  "code": "S",
  "message": "操作成功",
  "data": {
    "id": "NOTIF001",
    "isArchived": true
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

### 9. 删除通知
**接口地址**: `DELETE /api/v1/notifications/{id}`

**路径参数**:
- `id`: 通知ID

**响应**: HTTP 204 No Content（无响应体）

---

### 10. 批量删除通知
**接口地址**: `DELETE /api/v1/notifications/batch`

**请求参数**:
```json
{
  "notificationIds": ["NOTIF001", "NOTIF002", "NOTIF003"]
}
```

**响应**: HTTP 204 No Content（无响应体）

---

## 通知配置相关接口

### 11. 获取通知渠道列表
**接口地址**: `GET /api/v1/notifications/channels`

**响应数据**:
```json
{
  "code": "S",
  "message": "成功",
  "data": [
    {
      "tenantId": "1",
      "createdBy": "1000001",
      "creator": "系统管理员",
      "createdDate": "2024-11-01 10:00:00",
      "modifiedBy": "1000001",
      "modifier": "系统管理员",
      "modifiedDate": "2025-12-03 14:30:00",
      "id": "CH001",
      "name": "System Email",
      "type": "email",
      "isEnabled": true,
      "stats": {
        "sent": 12370,
        "lastSent": "2024-12-02 10:30:00"
      },
      "config": {
        "host": "smtp.gmail.com",
        "port": "587",
        "from": "system@angusgm.com"
      },
      "verified": true
    },
    {
      "tenantId": "1",
      "createdBy": "1000001",
      "creator": "系统管理员",
      "createdDate": "2024-11-05 14:20:00",
      "modifiedBy": "1000001",
      "modifier": "系统管理员",
      "modifiedDate": "2025-12-03 14:30:00",
      "id": "CH002",
      "name": "Slack Alerts",
      "type": "slack",
      "isEnabled": true,
      "stats": {
        "sent": 8560,
        "lastSent": "2024-12-02 09:15:00"
      },
      "config": {
        "webhookUrl": "https://hooks.slack.com/services/***",
        "channel": "#alerts"
      },
      "verified": true
    }
  ],
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

### 12. 创建通知渠道
**接口地址**: `POST /api/v1/notifications/channels`

**请求参数**:
```json
{
  "name": "New Email Channel",
  "type": "email",
  "isEnabled": true,
  "config": {
    "host": "smtp.example.com",
    "port": "587",
    "from": "notify@example.com",
    "username": "notify@example.com",
    "password": "password123"
  }
}
```

**响应数据**: 同获取通知渠道列表中的单项数据

---

### 13. 更新通知渠道
**接口地址**: `PUT /api/v1/notifications/channels/{id}`

**路径参数**:
- `id`: 渠道ID

**请求参数**: 同创建通知渠道

**响应数据**: 同获取通知渠道列表中的单项数据

---

### 14. 删除通知渠道
**接口地址**: `DELETE /api/v1/notifications/channels/{id}`

**路径参数**:
- `id`: 渠道ID

**响应**: HTTP 204 No Content（无响应体）

---

### 15. 测试通知渠道
**接口地址**: `POST /api/v1/notifications/channels/{id}/test`

**路径参数**:
- `id`: 渠道ID

**响应数据**:
```json
{
  "code": "S",
  "message": "测试成功",
  "data": {
    "channelId": "CH001",
    "testTime": "2025-12-19 11:00:00",
    "success": true,
    "message": "测试消息已发送"
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

### 16. 获取通知规则列表
**接口地址**: `GET /api/v1/notifications/rules`

**响应数据**:
```json
{
  "code": "S",
  "message": "成功",
  "data": [
    {
      "tenantId": "1",
      "createdBy": "1000001",
      "creator": "系统管理员",
      "createdDate": "2024-11-10 10:00:00",
      "modifiedBy": "1000001",
      "modifier": "系统管理员",
      "modifiedDate": "2025-12-03 14:30:00",
      "id": "RULE001",
      "name": "用户登录失败告警",
      "event": "user.login.failed",
      "channels": ["CH001", "CH002"],
      "conditions": "attempts >= 3",
      "isEnabled": true
    }
  ],
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

### 17. 创建通知规则
**接口地址**: `POST /api/v1/notifications/rules`

**请求参数**:
```json
{
  "name": "用户登录失败告警",
  "event": "user.login.failed",
  "channels": ["CH001", "CH002"],
  "conditions": "attempts >= 3",
  "isEnabled": true
}
```

**响应数据**: 同获取通知规则列表中的单项数据

---

### 18. 获取通知历史
**接口地址**: `GET /api/v1/notifications/history`

**查询参数**:
- `page`: 页码，默认1
- `size`: 每页大小，默认10
- `channelId`: 渠道筛选
- `status`: 状态筛选（success、failed、pending）

**响应数据**:
```json
{
  "code": "S",
  "message": "成功",
  "data": {
    "total": "1250",
    "list": [
      {
        "id": "HIST001",
        "title": "用户登录失败告警",
        "channel": "System Email",
        "channelType": "email",
        "recipient": "admin@angusgm.com",
        "status": "success",
        "sentAt": "2025-12-19 10:30:00",
        "error": null
      },
      {
        "id": "HIST002",
        "title": "系统维护通知",
        "channel": "Slack Alerts",
        "channelType": "slack",
        "recipient": "#alerts",
        "status": "failed",
        "sentAt": "2025-12-19 10:25:00",
        "error": "Webhook URL无效"
      }
    ]
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

## 错误码说明

| 错误码 | 说明 |
|--------|------|
| NOTIF_001 | 通知不存在 |
| NOTIF_002 | 通知渠道不存在 |
| NOTIF_003 | 通知渠道配置错误 |
| NOTIF_004 | 通知发送失败 |
| NOTIF_005 | 通知规则不存在 |
