# 接口监控模块 - 后端API接口文档

## 基础信息
- **模块名称**: 接口监控
- **模块路径**: `/api/v1/interface-monitoring`
- **负责功能**: API接口调用监控、性能分析、异常追踪

---

## 接口列表

### 1. 获取接口监控概览
**接口地址**: `GET /api/v1/interface-monitoring/overview`

**响应数据**:
```json
{
  "code": "S",
  "message": "成功",
  "data": {
    "totalRequests": 1250000,
    "successRequests": 1248500,
    "failedRequests": 1500,
    "avgResponseTime": 125,
    "qps": 2500,
    "errorRate": 0.12,
    "slowRequestCount": 256
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

## 接口调用统计

### 2. 获取接口调用统计列表（分页）
**接口地址**: `GET /api/v1/interface-monitoring/stats`

**查询参数**:
- `page`: 页码，默认1
- `size`: 每页大小，默认20
- `serviceName`: 服务名称筛选
- `path`: 接口路径筛选
- `method`: 请求方法筛选
- `startDate`: 开始日期
- `endDate`: 结束日期
- `sortBy`: 排序字段（calls、avgTime、errorRate）
- `order`: 排序方向（asc、desc）

**响应数据**:
```json
{
  "code": "S",
  "message": "成功",
  "data": {
    "total": "125",
    "list": [
      {
        "id": "STAT_001",
        "serviceName": "ANGUS-GM-SERVICE",
        "path": "/api/v1/users",
        "method": "GET",
        "totalCalls": 50000,
        "successCalls": 49800,
        "failedCalls": 200,
        "avgResponseTime": 125,
        "maxResponseTime": 3500,
        "minResponseTime": 10,
        "errorRate": 0.4,
        "qps": 1250
      }
    ]
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

### 3. 获取单个接口详细统计
**接口地址**: `GET /api/v1/interface-monitoring/stats/{serviceName}/{path}`

**路径参数**:
- `serviceName`: 服务名称
- `path`: 接口路径（URL编码）

**查询参数**:
- `startDate`: 开始日期
- `endDate`: 结束日期
- `period`: 时间周期（1h、6h、24h、7d、30d）

**响应数据**:
```json
{
  "code": "S",
  "message": "成功",
  "data": {
    "serviceName": "ANGUS-GM-SERVICE",
    "path": "/api/v1/users",
    "method": "GET",
    "period": {
      "startDate": "2025-12-12",
      "endDate": "2025-12-19"
    },
    "summary": {
      "totalCalls": 50000,
      "successCalls": 49800,
      "failedCalls": 200,
      "avgResponseTime": 125,
      "errorRate": 0.4
    },
    "timeline": [
      {
        "time": "2025-12-12 00:00:00",
        "calls": 7500,
        "avgResponseTime": 120,
        "errorRate": 0.3
      },
      {
        "time": "2025-12-13 00:00:00",
        "calls": 7200,
        "avgResponseTime": 125,
        "errorRate": 0.4
      }
    ],
    "responseTimeDistribution": {
      "0-100ms": 30000,
      "100-500ms": 15000,
      "500-1000ms": 3500,
      "1000-3000ms": 1200,
      "3000ms+": 300
    },
    "statusCodeDistribution": {
      "200": 49800,
      "400": 50,
      "401": 80,
      "500": 70
    }
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

## 慢请求分析

### 4. 获取慢请求列表（分页）
**接口地址**: `GET /api/v1/interface-monitoring/slow-requests`

**查询参数**:
- `page`: 页码，默认1
- `size`: 每页大小，默认20
- `serviceName`: 服务名称筛选
- `path`: 接口路径筛选
- `minDuration`: 最小耗时（毫秒），默认1000
- `startDate`: 开始日期
- `endDate`: 结束日期

**响应数据**:
```json
{
  "code": "S",
  "message": "成功",
  "data": {
    "total": "256",
    "list": [
      {
        "tenantId": "1",
        "createdBy": "SYSTEM",
        "creator": "系统",
        "createdDate": "2025-12-19 10:30:00",
        "modifiedBy": "SYSTEM",
        "modifier": "系统",
        "modifiedDate": "2025-12-19 10:30:00",
        "id": "SLOW_001",
        "traceId": "trace-abc123",
        "serviceName": "ANGUS-GM-SERVICE",
        "path": "/api/v1/users",
        "method": "GET",
        "requestTime": "2025-12-19 10:30:00",
        "duration": 3500,
        "statusCode": 200,
        "ipAddress": "192.168.1.100",
        "userId": "U001",
        "parameters": {
          "page": "1",
          "size": "100"
        }
      }
    ]
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

### 5. 获取慢请求详情
**接口地址**: `GET /api/v1/interface-monitoring/slow-requests/{id}`

**路径参数**:
- `id`: 慢请求记录ID

**响应数据**:
```json
{
  "code": "S",
  "message": "成功",
  "data": {
    "id": "SLOW_001",
    "traceId": "trace-abc123",
    "serviceName": "ANGUS-GM-SERVICE",
    "path": "/api/v1/users",
    "method": "GET",
    "requestTime": "2025-12-19 10:30:00",
    "duration": 3500,
    "statusCode": 200,
    "ipAddress": "192.168.1.100",
    "userId": "U001",
    "userName": "张三",
    "requestHeaders": {
      "Authorization": "Bearer ***",
      "Content-Type": "application/json"
    },
    "requestBody": null,
    "responseBody": "...",
    "breakdown": {
      "databaseQuery": 2800,
      "businessLogic": 500,
      "network": 200
    },
    "sqlStatements": [
      {
        "sql": "SELECT * FROM users WHERE status = ?",
        "duration": 2500,
        "rows": 1000
      }
    ]
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

## 错误请求分析

### 6. 获取错误请求列表（分页）
**接口地址**: `GET /api/v1/interface-monitoring/error-requests`

**查询参数**:
- `page`: 页码，默认1
- `size`: 每页大小，默认20
- `serviceName`: 服务名称筛选
- `path`: 接口路径筛选
- `statusCode`: HTTP状态码筛选
- `startDate`: 开始日期
- `endDate`: 结束日期

**响应数据**:
```json
{
  "code": "S",
  "message": "成功",
  "data": {
    "total": "1500",
    "list": [
      {
        "tenantId": "1",
        "createdBy": "SYSTEM",
        "creator": "系统",
        "createdDate": "2025-12-19 10:30:00",
        "modifiedBy": "SYSTEM",
        "modifier": "系统",
        "modifiedDate": "2025-12-19 10:30:00",
        "id": "ERROR_001",
        "traceId": "trace-def456",
        "serviceName": "ANGUS-GM-SERVICE",
        "path": "/api/v1/users",
        "method": "POST",
        "requestTime": "2025-12-19 10:30:00",
        "duration": 125,
        "statusCode": 500,
        "errorMessage": "Internal Server Error",
        "errorType": "NullPointerException",
        "ipAddress": "192.168.1.100",
        "userId": "U001"
      }
    ]
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

### 7. 获取错误请求详情
**接口地址**: `GET /api/v1/interface-monitoring/error-requests/{id}`

**路径参数**:
- `id`: 错误请求记录ID

**响应数据**:
```json
{
  "code": "S",
  "message": "成功",
  "data": {
    "id": "ERROR_001",
    "traceId": "trace-def456",
    "serviceName": "ANGUS-GM-SERVICE",
    "path": "/api/v1/users",
    "method": "POST",
    "requestTime": "2025-12-19 10:30:00",
    "duration": 125,
    "statusCode": 500,
    "errorMessage": "Internal Server Error",
    "errorType": "NullPointerException",
    "ipAddress": "192.168.1.100",
    "userId": "U001",
    "userName": "张三",
    "requestHeaders": {
      "Authorization": "Bearer ***",
      "Content-Type": "application/json"
    },
    "requestBody": "{\"name\":\"test\"}",
    "responseBody": "{\"error\":\"Internal Server Error\"}",
    "stackTrace": "java.lang.NullPointerException\n\tat com.angus.UserService.createUser...",
    "resolved": false
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

## 实时监控

### 8. 获取实时QPS数据
**接口地址**: `GET /api/v1/interface-monitoring/realtime/qps`

**响应数据**:
```json
{
  "code": "S",
  "message": "成功",
  "data": {
    "current": 2500,
    "peak": 3200,
    "average": 2100,
    "timeline": [
      {
        "time": "2025-12-19 10:29:00",
        "qps": 2400
      },
      {
        "time": "2025-12-19 10:29:30",
        "qps": 2500
      },
      {
        "time": "2025-12-19 10:30:00",
        "qps": 2500
      }
    ]
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

### 9. 获取实时响应时间数据
**接口地址**: `GET /api/v1/interface-monitoring/realtime/response-time`

**响应数据**:
```json
{
  "code": "S",
  "message": "成功",
  "data": {
    "current": 125,
    "p50": 100,
    "p95": 500,
    "p99": 1000,
    "max": 3500,
    "timeline": [
      {
        "time": "2025-12-19 10:29:00",
        "avg": 120,
        "p95": 480
      },
      {
        "time": "2025-12-19 10:29:30",
        "avg": 122,
        "p95": 490
      },
      {
        "time": "2025-12-19 10:30:00",
        "avg": 125,
        "p95": 500
      }
    ]
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

## TOP排行

### 10. 获取调用量TOP接口
**接口地址**: `GET /api/v1/interface-monitoring/top/calls`

**查询参数**:
- `limit`: 返回数量，默认10
- `period`: 时间周期（1h、6h、24h、7d、30d）

**响应数据**:
```json
{
  "code": "S",
  "message": "成功",
  "data": [
    {
      "serviceName": "ANGUS-GM-SERVICE",
      "path": "/api/v1/users",
      "method": "GET",
      "calls": 50000,
      "errorRate": 0.4
    },
    {
      "serviceName": "ANGUS-AUTH-SERVICE",
      "path": "/api/v1/auth/login",
      "method": "POST",
      "calls": 45000,
      "errorRate": 0.2
    }
  ],
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

### 11. 获取响应时间TOP接口
**接口地址**: `GET /api/v1/interface-monitoring/top/slow`

**查询参数**:
- `limit`: 返回数量，默认10
- `period`: 时间周期（1h、6h、24h、7d、30d）

**响应数据**:
```json
{
  "code": "S",
  "message": "成功",
  "data": [
    {
      "serviceName": "ANGUS-GM-SERVICE",
      "path": "/api/v1/reports/export",
      "method": "POST",
      "avgResponseTime": 2500,
      "calls": 500
    },
    {
      "serviceName": "ANGUS-GM-SERVICE",
      "path": "/api/v1/users",
      "method": "GET",
      "avgResponseTime": 1800,
      "calls": 50000
    }
  ],
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

### 12. 获取错误率TOP接口
**接口地址**: `GET /api/v1/interface-monitoring/top/errors`

**查询参数**:
- `limit`: 返回数量，默认10
- `period`: 时间周期（1h、6h、24h、7d、30d）

**响应数据**:
```json
{
  "code": "S",
  "message": "成功",
  "data": [
    {
      "serviceName": "ANGUS-PAYMENT-SERVICE",
      "path": "/api/v1/payment/process",
      "method": "POST",
      "errorRate": 5.2,
      "calls": 10000,
      "failedCalls": 520
    },
    {
      "serviceName": "ANGUS-GM-SERVICE",
      "path": "/api/v1/users",
      "method": "POST",
      "errorRate": 2.1,
      "calls": 5000,
      "failedCalls": 105
    }
  ],
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

## 错误码说明

| 错误码 | 说明 |
|--------|------|
| IMONITOR_001 | 监控数据不存在 |
| IMONITOR_002 | 慢请求记录不存在 |
| IMONITOR_003 | 错误请求记录不存在 |
| IMONITOR_004 | 时间周期参数错误 |
