# 系统版本模块 - 后端API接口文档

## 基础信息
- **模块名称**: 系统版本
- **模块路径**: `/api/v1/system-version`
- **负责功能**: 系统版本信息、更新管理、变更日志

---

## 接口列表

### 1. 获取当前系统版本信息
**接口地址**: `GET /api/v1/system-version/current`

**响应数据**:
```json
{
  "code": "S",
  "message": "成功",
  "data": {
    "version": "1.5.2",
    "buildNumber": "20251219001",
    "releaseDate": "2025-12-15",
    "environment": "production",
    "components": {
      "backend": {
        "version": "1.5.2",
        "framework": "Spring Boot 3.2.0",
        "javaVersion": "17.0.9"
      },
      "frontend": {
        "version": "1.5.2",
        "framework": "React 18.2.0",
        "nodeVersion": "20.10.0"
      },
      "database": {
        "type": "MySQL",
        "version": "8.0.35"
      },
      "cache": {
        "type": "Redis",
        "version": "6.2.6"
      }
    },
    "uptime": "15天 6小时 23分钟",
    "startTime": "2025-12-04 10:00:00"
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

### 2. 获取版本历史列表（分页）
**接口地址**: `GET /api/v1/system-version/history`

**查询参数**:
- `page`: 页码，默认1
- `size`: 每页大小，默认10

**响应数据**:
```json
{
  "code": "S",
  "message": "成功",
  "data": {
    "total": "25",
    "list": [
      {
        "tenantId": "1",
        "createdBy": "SYSTEM",
        "creator": "系统",
        "createdDate": "2025-12-15 10:00:00",
        "modifiedBy": "SYSTEM",
        "modifier": "系统",
        "modifiedDate": "2025-12-15 10:00:00",
        "id": "VER_001",
        "version": "1.5.2",
        "buildNumber": "20251219001",
        "releaseDate": "2025-12-15",
        "releaseType": "patch",
        "title": "Bug修复和性能优化",
        "description": "修复了多个已知问题，优化了系统性能",
        "isCurrentVersion": true,
        "deploymentDate": "2025-12-15 10:00:00",
        "deployedBy": "系统管理员"
      },
      {
        "tenantId": "1",
        "createdBy": "SYSTEM",
        "creator": "系统",
        "createdDate": "2025-11-20 10:00:00",
        "modifiedBy": "SYSTEM",
        "modifier": "系统",
        "modifiedDate": "2025-11-20 10:00:00",
        "id": "VER_002",
        "version": "1.5.0",
        "buildNumber": "20251120001",
        "releaseDate": "2025-11-20",
        "releaseType": "minor",
        "title": "新增LDAP集成功能",
        "description": "支持LDAP用户同步和认证",
        "isCurrentVersion": false,
        "deploymentDate": "2025-11-20 10:00:00",
        "deployedBy": "系统管理员"
      }
    ]
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

### 3. 获取版本详情
**接口地址**: `GET /api/v1/system-version/history/{id}`

**路径参数**:
- `id`: 版本ID

**响应数据**:
```json
{
  "code": "S",
  "message": "成功",
  "data": {
    "id": "VER_001",
    "version": "1.5.2",
    "buildNumber": "20251219001",
    "releaseDate": "2025-12-15",
    "releaseType": "patch",
    "title": "Bug修复和性能优化",
    "description": "修复了多个已知问题，优化了系统性能",
    "isCurrentVersion": true,
    "deploymentDate": "2025-12-15 10:00:00",
    "deployedBy": "系统管理员",
    "features": [
      {
        "type": "fix",
        "module": "用户管理",
        "description": "修复了批量导入用户时的数据校验问题"
      },
      {
        "type": "improvement",
        "module": "接口监控",
        "description": "优化了慢查询分析的性能"
      },
      {
        "type": "fix",
        "module": "权限管理",
        "description": "修复了角色权限继承的bug"
      }
    ],
    "breakingChanges": [],
    "migrations": [],
    "dependencies": {
      "updated": [
        {
          "name": "Spring Boot",
          "from": "3.1.5",
          "to": "3.2.0"
        }
      ],
      "added": [],
      "removed": []
    }
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

### 4. 获取变更日志
**接口地址**: `GET /api/v1/system-version/changelog`

**查询参数**:
- `version`: 指定版本号，不传则返回所有版本
- `page`: 页码，默认1
- `size`: 每页大小，默认10

**响应数据**:
```json
{
  "code": "S",
  "message": "成功",
  "data": {
    "total": "125",
    "list": [
      {
        "version": "1.5.2",
        "releaseDate": "2025-12-15",
        "changes": [
          {
            "type": "fix",
            "module": "用户管理",
            "description": "修复了批量导入用户时的数据校验问题",
            "issueId": "ISSUE-1234"
          },
          {
            "type": "improvement",
            "module": "接口监控",
            "description": "优化了慢查询分析的性能",
            "issueId": "ISSUE-1235"
          }
        ]
      },
      {
        "version": "1.5.0",
        "releaseDate": "2025-11-20",
        "changes": [
          {
            "type": "feature",
            "module": "系统管理",
            "description": "新增LDAP集成功能",
            "issueId": "FEATURE-500"
          }
        ]
      }
    ]
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

### 5. 检查更新
**接口地址**: `GET /api/v1/system-version/check-update`

**响应数据**:
```json
{
  "code": "S",
  "message": "成功",
  "data": {
    "hasUpdate": true,
    "currentVersion": "1.5.2",
    "latestVersion": "1.6.0",
    "releaseDate": "2025-12-20",
    "releaseType": "minor",
    "title": "新增资源配额管理功能",
    "description": "支持租户资源配额的精细化管理和监控",
    "downloadUrl": "https://releases.angusgm.com/v1.6.0/angusgm-1.6.0.tar.gz",
    "fileSize": "125 MB",
    "releaseNotes": "https://docs.angusgm.com/releases/v1.6.0",
    "breakingChanges": false,
    "requiresDowntime": false
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

### 6. 获取系统依赖信息
**接口地址**: `GET /api/v1/system-version/dependencies`

**响应数据**:
```json
{
  "code": "S",
  "message": "成功",
  "data": {
    "backend": [
      {
        "name": "Spring Boot",
        "version": "3.2.0",
        "type": "framework"
      },
      {
        "name": "Spring Security",
        "version": "6.2.0",
        "type": "security"
      },
      {
        "name": "MyBatis Plus",
        "version": "3.5.5",
        "type": "orm"
      }
    ],
    "frontend": [
      {
        "name": "React",
        "version": "18.2.0",
        "type": "framework"
      },
      {
        "name": "React Router",
        "version": "6.20.0",
        "type": "routing"
      },
      {
        "name": "Tailwind CSS",
        "version": "4.0.0",
        "type": "styling"
      }
    ],
    "infrastructure": [
      {
        "name": "MySQL",
        "version": "8.0.35",
        "type": "database"
      },
      {
        "name": "Redis",
        "version": "6.2.6",
        "type": "cache"
      },
      {
        "name": "Eureka",
        "version": "2023.0.0",
        "type": "service-registry"
      }
    ]
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

### 7. 获取系统许可证信息
**接口地址**: `GET /api/v1/system-version/license`

**响应数据**:
```json
{
  "code": "S",
  "message": "成功",
  "data": {
    "licenseType": "企业版",
    "licenseTo": "联普云（北京）科技有限公司",
    "licenseKey": "ANGUS-GM-ENT-****-****-****",
    "issuedDate": "2024-01-01",
    "expiryDate": "2025-12-31",
    "remainingDays": 12,
    "status": "有效",
    "maxTenants": 100,
    "maxUsers": 10000,
    "features": [
      "LDAP集成",
      "SSO单点登录",
      "高级审计",
      "API访问",
      "技术支持"
    ]
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

### 8. 更新许可证
**接口地址**: `PUT /api/v1/system-version/license`

**请求参数**:
```json
{
  "licenseKey": "ANGUS-GM-ENT-XXXX-XXXX-XXXX-XXXX"
}
```

**响应数据**: 同系统许可证信息

---

### 9. 获取系统环境信息
**接口地址**: `GET /api/v1/system-version/environment`

**响应数据**:
```json
{
  "code": "S",
  "message": "成功",
  "data": {
    "os": {
      "name": "Linux",
      "version": "Ubuntu 22.04.3 LTS",
      "arch": "x86_64"
    },
    "java": {
      "version": "17.0.9",
      "vendor": "Oracle Corporation",
      "home": "/usr/lib/jvm/java-17-openjdk"
    },
    "memory": {
      "total": "32 GB",
      "max": "28 GB",
      "free": "8 GB",
      "used": "20 GB"
    },
    "cpu": {
      "cores": 8,
      "processors": 16,
      "model": "Intel(R) Xeon(R) CPU E5-2680 v4 @ 2.40GHz"
    },
    "disk": {
      "total": "2 TB",
      "free": "856 GB",
      "usable": "856 GB"
    }
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

### 10. 获取版本对比
**接口地址**: `GET /api/v1/system-version/compare`

**查询参数**:
- `fromVersion`: 起始版本号
- `toVersion`: 目标版本号

**响应数据**:
```json
{
  "code": "S",
  "message": "成功",
  "data": {
    "fromVersion": "1.5.0",
    "toVersion": "1.5.2",
    "features": {
      "added": [
        {
          "module": "系统监控",
          "description": "新增CPU使用率告警功能"
        }
      ],
      "improved": [
        {
          "module": "接口监控",
          "description": "优化了慢查询分析的性能"
        }
      ],
      "fixed": [
        {
          "module": "用户管理",
          "description": "修复了批量导入用户时的数据校验问题"
        },
        {
          "module": "权限管理",
          "description": "修复了角色权限继承的bug"
        }
      ],
      "removed": []
    },
    "breakingChanges": [],
    "migrations": []
  },
  "timestamp": "1763958969885",
  "extensions": {}
}
```

---

## 错误码说明

| 错误码 | 说明 |
|--------|------|
| VERSION_001 | 版本不存在 |
| VERSION_002 | 许可证无效 |
| VERSION_003 | 许可证已过期 |
| VERSION_004 | 版本对比失败 |
| VERSION_005 | 更新检查失败 |
