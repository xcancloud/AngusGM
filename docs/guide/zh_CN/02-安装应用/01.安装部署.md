AngusGM 应用安装部署
====

本手册提供 **ZIP包**、**Docker** 和 **Docker Compose** 三种部署方式，请根据实际需求选择适合的方案。

### 一、部署前准备

- **系统要求**
  - 操作系统：支持系统 `Linux/Windows/macOS`。
  - 计算资源：最小配置要求 `2核CPU、4GB内存`，推荐配置 `4核CPU、8GB内存`。
  - 磁盘空间：最小 10GB 可用空间，推荐配置 `100GB`。

- **运行环境**
  - ZIP 包部署：需要配置 `OpenJDK 17+`。
  - Docker 部署：需要安装 Docker，推荐版本 `V20+`。
  - Docker Compose 部署：需要安装 Docker Compose，推荐版本 `v2.6+`。

- **应用版本**
  - 社区版本（Community）：永久免费版本。
  - 企业版本（Enterprise）：收费版本，需要获取许可。功能和社区版本无差异，支持更多用户。
  - 数据中心版本（Datacenter）：收费版本，需要获取许可。功能和社区版本无差异，支持多租户和更多用户。
  
  ***注意：*** 以下是针对`社区版`安装过程说明，如果需要安装其他版本，将版本类型标志`Community`替换成`Enterprise`或`Datacenter`即可。

### 二、安装步骤

**1. ZIP 包安装**

```bash
# 下载安装包
curl -LO https://nexus.xcan.cloud/repository/release/package/AngusGM-Community-1.0.0.zip

# 解压安装包至目标目录
unzip AngusGM-Community-1.0.0.zip -d /opt/AngusGM

# 进入安装目录
cd /opt/AngusGM

# 启动服务
./bin/startup.sh

# 停止服务
./bin/shutdown.sh
```

**2. Docker 容器安装**
```bash
# 启动容器（挂载自定义配置文件）
docker run -d \
  --name angusgm \
  -p 8802:8802 \
  -v /host/config:/app/config \
  angusgm/angusgm:2.0

# 停止并删除容器
docker stop angusgm && docker rm angusgm
```

**3. Docker Compose 安装**

**场景1：不包含中间件（需提前部署MySQL/Redis）**
1. 创建 `docker-compose.yml` 文件：
```yaml
version: '3.8'
services:
  angusgm:
    image: angusgm/angusgm:2.0
    ports:
      - "8802:8802"
    environment:
      - GM_DB_HOST=192.168.0.70    # 外部MySQL地址
      - REDIS_HOST=dev-mw.xcan.cloud # 外部Redis地址
```

2. 启动服务：
```bash
docker-compose up -d
```

**场景2：包含中间件（自动部署MySQL/Redis）**
1. 创建 `docker-compose-full.yml` 文件：
```yaml
version: '3.8'
services:
  angusgm:
    image: angusgm/angusgm:2.0
    ports:
      - "8802:8802"
    depends_on:
      - mysql
      - redis

  mysql:
    image: mysql:8.0
    environment:
      MYSQL_ROOT_PASSWORD: Angus123
      MYSQL_DATABASE: Angus
      MYSQL_USER: Angus
      MYSQL_PASSWORD: Angus123

  redis:
    image: redis:6.2
    command: redis-server --requirepass AcMMebXwmXPgrlC@ccH
```

2. 启动服务：
```bash
docker-compose -f docker-compose-full.yml up -d
```

3. 停止服务：
```bash
docker-compose -f docker-compose-full.yml down
```

---

**四、部署验证**

1. **健康检查端点验证**
```bash
curl http://localhost:8802/actuator/health
# 预期输出：{"status":"UP"}
```

2. **登录验证**
- 访问地址：`http://<部署IP>:8802`
- 默认账号：
    - 用户名：`admin`
    - 密码：`admin@123`

---

**五、配置参数说明**

**关键参数概览**  
| 参数分类       | 参数名               | 说明                                | 默认值/示例值                |
|----------------|----------------------|-------------------------------------|-----------------------------|
| **安装配置**   | `INSTALL_TYPE`       | 部署类型（SHARED/STANDALONE）       | SHARED                      |
| **数据库配置** | `GM_DB_HOST`         | 数据库地址                          | 192.168.0.70               |
|                | `GM_DB_PASSWORD`     | 数据库密码                          | Angus123                   |
| **Redis配置**  | `REDIS_HOST`         | Redis地址                           | dev-mw.xcan.cloud          |
|                | `REDIS_PASSWORD`     | Redis密码                           | AcMMebXwmXPgrlC@ccH        |
| **管理员账户** | `GM_ADMIN_PASSWORD`  | 管理员初始密码                      | admin@123                  |

> 完整配置参数请参考安装包内 `config/application-template.yml` 或附件配置文件。

---

**六、故障排查**

**1. 常见问题**
- **问题：端口冲突**
    - 错误示例：`Error: Port 8802 already in use`
    - 解决方案：修改 `GM_PORT` 参数或终止占用端口的进程。

- **问题：数据库连接失败**
    - 错误示例：`Connection refused to MySQL at 192.168.0.70:3306`
    - 解决方案：检查网络连通性、防火墙规则及数据库凭证。

**2. 日志分析**
- **日志路径**
    - ZIP包：`/opt/angusgm/logs/error.log`
    - Docker容器：`/app/logs/angusgm.log`
- **关键检索词**：`ERROR`、`Connection refused`、`Authentication failed`

**3. 技术支持**
- 联系邮箱：`support@angusgm.com`
- 邮件要求：附错误日志截图及环境信息（部署方式、版本号）。

---

**附录**
- **安全建议**：生产环境务必修改默认密码（如 `GM_ADMIN_PASSWORD`、`GM_DB_PASSWORD`）。
- **数据持久化**：Docker部署时建议挂载数据卷（如MySQL数据目录）。
